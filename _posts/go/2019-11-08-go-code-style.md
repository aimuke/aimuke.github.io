---
title: "å¦‚ä½•å†™å‡ºä¼˜é›…çš„ Golang ä»£ç "
tags: [go, todo]
--- 

Go è¯­è¨€æ˜¯ä¸€é—¨ç®€å•ã€æ˜“å­¦çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¯¹äºæœ‰ç¼–ç¨‹èƒŒæ™¯çš„å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œå­¦ä¹  Go è¯­è¨€å¹¶å†™å‡ºèƒ½å¤Ÿè¿è¡Œçš„ä»£ç å¹¶ä¸æ˜¯ä¸€ä»¶å›°éš¾çš„äº‹æƒ…ï¼Œå¯¹äºä¹‹å‰æœ‰è¿‡å…¶ä»–è¯­è¨€ç»éªŒçš„å¼€å‘è€…æ¥è¯´ï¼Œå†™ä»€ä¹ˆè¯­è¨€éƒ½åƒè‡ªå·±å­¦è¿‡çš„è¯­è¨€å…¶å®æ˜¯æœ‰é—®é¢˜çš„ï¼Œæƒ³è¦çœŸæ­£èå…¥ç”Ÿæ€å†™å‡ºä¼˜é›…çš„ä»£ç å°±ä¸€å®šè¦èŠ±ä¸€äº›æ—¶é—´å’Œç²¾åŠ›äº†è§£è¯­è¨€èƒŒåçš„è®¾è®¡å“²å­¦å’Œæœ€ä½³å®è·µã€‚

å¦‚æœä½ ä¹‹å‰æ²¡æœ‰ Go è¯­è¨€çš„å¼€å‘ç»å†ï¼Œæ­£åœ¨å­¦ä¹ å’Œä½¿ç”¨ Go è¯­è¨€ï¼Œç›¸ä¿¡è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¿«åœ°å†™å‡ºä¼˜é›…çš„ Go è¯­è¨€ä»£ç ï¼›åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šç»™ä¸€ä¸ªé•¿é•¿åœ°åˆ—è¡¨ä»‹ç»å˜é‡ã€æ–¹æ³•å’Œç»“æ„ä½“åº”è¯¥æ€ä¹ˆå‘½åï¼Œè¿™äº› Go è¯­è¨€çš„ä»£ç è§„èŒƒå¯ä»¥åœ¨ [Go Code Review Comments](https://github.com/golang/go/wiki/CodeReviewComments) ä¸­æ‰¾åˆ°ï¼Œå®ƒä»¬éå¸¸é‡è¦ä½†å¹¶ä¸æ˜¯è¿™ç¯‡æ–‡ç« æƒ³è¦ä»‹ç»çš„é‡ç‚¹ï¼Œæˆ‘ä»¬å°†ä»ä»£ç ç»“æ„ã€æœ€ä½³å®è·µä»¥åŠå•å…ƒæµ‹è¯•å‡ ä¸ªä¸åŒçš„æ–¹é¢ä»‹ç»å¦‚ä½•å†™å‡ºä¼˜é›…çš„ Go è¯­è¨€ä»£ç ã€‚

# å†™åœ¨å‰é¢
æƒ³è¦å†™å‡ºå¥½çš„ä»£ç å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œå®ƒéœ€è¦æˆ‘ä»¬ä¸æ–­åœ°å¯¹ç°æœ‰çš„ä»£ç è¿›è¡Œåæ€ â€” å¦‚ä½•æ”¹å†™è¿™æ®µä»£ç æ‰èƒ½è®©å®ƒå˜å¾—æ›´åŠ ä¼˜é›…ã€‚ä¼˜é›…å¬èµ·æ¥æ˜¯ä¸€ä¸ªéå¸¸æ„Ÿæ€§ã€éš¾ä»¥é‡åŒ–çš„ç»“æœï¼Œç„¶è€Œè¿™å´æ˜¯å¥½çš„ä»£ç èƒ½å¤Ÿå¸¦æ¥çš„æœ€ç›´è§‚æ„Ÿå—ï¼Œå®ƒå¯èƒ½éšå¼åœ°åŒ…å«äº†ä»¥ä¸‹ç‰¹æ€§ï¼š

- å®¹æ˜“é˜…è¯»å’Œç†è§£ï¼›
- å®¹æ˜“æµ‹è¯•ã€ç»´æŠ¤å’Œæ‰©å±•ï¼›
- å‘½åæ¸…æ™°ã€æ— æ­§ä¹‰ã€æ³¨é‡Šå®Œå–„æ¸…æ¥šï¼›
- â€¦

ç›¸ä¿¡è¯»å®Œäº†è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½ç«‹åˆ»å†™å‡ºä¼˜é›…çš„ Go è¯­è¨€ä»£ç ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éµå¾ªè¿™é‡Œä»‹ç»å‡ ä¸ªçš„å®¹æ˜“æ“ä½œå¹¶ä¸”åˆ‡å®å¯è¡Œçš„æ–¹æ³•ï¼Œå°±å¸®åŠ©æˆ‘ä»¬èµ°å‡ºç¬¬ä¸€æ­¥ï¼Œä½œè€…å†™è¿™ç¯‡æ–‡ç« æœ‰ä»¥ä¸‹çš„å‡ ä¸ªç›®çš„ï¼š

- å¸®åŠ© Go è¯­è¨€çš„å¼€å‘è€…äº†è§£ç”Ÿæ€ä¸­çš„è§„èŒƒä¸å·¥å…·ï¼Œå†™å‡ºæ›´ä¼˜é›…çš„ä»£ç ï¼›
- ä¸ºä»£ç å’Œé¡¹ç›®çš„ç®¡ç†æä¾›è¢«ç¤¾åŒºå¹¿æ³›è®¤åŒçš„è§„åˆ™ã€å…±è¯†ä»¥åŠæœ€ä½³å®è·µï¼›

# ä»£ç è§„èŒƒ

ä»£ç è§„èŒƒå…¶å®æ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸æ€çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½å…ä¿—è¿˜æ˜¯è¦ç®€å•ä»‹ç»ä¸€ä¸‹ç›¸å…³çš„å†…å®¹ï¼ŒGo è¯­è¨€æ¯”è¾ƒå¸¸è§å¹¶ä¸”ä½¿ç”¨å¹¿æ³›çš„ä»£ç è§„èŒƒå°±æ˜¯å®˜æ–¹æä¾›çš„ [Go Code Review Comments](https://github.com/golang/go/wiki/CodeReviewComments) ï¼Œæ— è®ºä½ æ˜¯çŸ­æœŸè¿˜æ˜¯é•¿æœŸä½¿ç”¨ Go è¯­è¨€ç¼–ç¨‹ï¼Œéƒ½åº”è¯¥è‡³å°‘å®Œæ•´åœ°é˜…è¯»ä¸€éè¿™ä¸ªå®˜æ–¹çš„ä»£ç è§„èŒƒæŒ‡å—ï¼Œå®ƒæ—¢æ˜¯æˆ‘ä»¬åœ¨å†™ä»£ç æ—¶åº”è¯¥éµå®ˆçš„è§„åˆ™ï¼Œä¹Ÿæ˜¯åœ¨ä»£ç å®¡æŸ¥æ—¶éœ€è¦æ³¨æ„çš„è§„èŒƒã€‚

å­¦ä¹  Go è¯­è¨€ç›¸å…³çš„ä»£ç è§„èŒƒæ˜¯ä¸€ä»¶éå¸¸é‡è¦çš„äº‹æƒ…ï¼Œä¹Ÿæ˜¯è®©æˆ‘ä»¬çš„é¡¹ç›®éµå¾ªç»Ÿä¸€è§„èŒƒçš„ç¬¬ä¸€æ­¥ï¼Œè™½ç„¶é˜…è¯»ä»£ç è§„èŒƒç›¸å…³çš„æ–‡æ¡£éå¸¸é‡è¦ï¼Œä½†æ˜¯åœ¨å®é™…æ“ä½œæ—¶æˆ‘ä»¬å¹¶ä¸èƒ½é å·¥ç¨‹å¸ˆè‡ªè§‰åœ°éµå®ˆä»¥åŠç»å¸¸è¢«å½“åšå½¢å¼çš„ä»£ç å®¡æŸ¥ï¼Œè€Œæ˜¯éœ€è¦å€ŸåŠ©å·¥å…·æ¥è¾…åŠ©æ‰§è¡Œã€‚

# è¾…åŠ©å·¥å…·

ä½¿ç”¨è‡ªåŠ¨åŒ–çš„å·¥å…·ä¿è¯é¡¹ç›®éµå®ˆä¸€äº›æœ€åŸºæœ¬çš„ä»£ç è§„èŒƒæ˜¯éå¸¸å®¹æ˜“æ“ä½œå’Œæœ‰æ•ˆçš„äº‹æƒ…ï¼Œç›¸æ¯”ä¹‹ä¸‹äººè‚‰å®¡æŸ¥ä»£ç çš„æ–¹å¼æ›´åŠ å®¹æ˜“å‡ºé”™ï¼Œä¹Ÿä¼šå‡ºç°ä¸€äº›è¿åè§„åˆ™å’Œçº¦å®šçš„ç‰¹ä¾‹ï¼Œç»´æŠ¤ä»£ç è§„èŒƒçš„æœ€å¥½æ–¹å¼å°±æ˜¯ã€`å°½é‡è‡ªåŠ¨åŒ–ä¸€åˆ‡èƒ½å¤Ÿè‡ªåŠ¨åŒ–çš„æ­¥éª¤ï¼Œè®©å·¥ç¨‹å¸ˆå®¡æŸ¥çœŸæ­£é‡è¦çš„é€»è¾‘å’Œè®¾è®¡`ã€ã€‚

æˆ‘ä»¬åœ¨è¿™ä¸€èŠ‚ä¸­å°±ä¼šä»‹ç»ä¸¤ç§éå¸¸åˆ‡å®æœ‰æ•ˆçš„åŠæ³•å¸®åŠ©æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­è‡ªåŠ¨åŒ–åœ°è¿›è¡Œä¸€äº›ä»£ç è§„èŒƒæ£€æŸ¥å’Œé™æ€æ£€æŸ¥ä¿è¯é¡¹ç›®çš„è´¨é‡ã€‚

## goimports

`goimports` æ˜¯ Go è¯­è¨€å®˜æ–¹æä¾›çš„å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿä¸ºæˆ‘ä»¬è‡ªåŠ¨æ ¼å¼åŒ– Go è¯­è¨€ä»£ç å¹¶å¯¹æ‰€æœ‰å¼•å…¥çš„åŒ…è¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬è‡ªåŠ¨å¢åˆ ä¾èµ–çš„åŒ…å¼•ç”¨ã€å°†ä¾èµ–åŒ…æŒ‰å­—æ¯åºæ’åºå¹¶åˆ†ç±»ã€‚ç›¸ä¿¡å¾ˆå¤šäººä½¿ç”¨çš„ IDE éƒ½ä¼šå°†å¦ä¸€ä¸ªå®˜æ–¹æä¾›çš„å·¥å…· `gofmt` å¯¹ä»£ç è¿›è¡Œæ ¼å¼åŒ–ï¼Œè€Œ `goimports` å°±æ˜¯ç­‰äº `gofmt` åŠ ä¸Š `ä¾èµ–åŒ…ç®¡ç†`ã€‚

![golang-goimports](https://img.draveness.me/golang-goimports.png)

å»ºè®®æ‰€æœ‰ Go è¯­è¨€çš„å¼€å‘è€…éƒ½åœ¨å¼€å‘æ—¶ä½¿ç”¨ `goimports` ï¼Œè™½ç„¶ `goimports` æœ‰æ—¶ä¼šå¼•å…¥é”™è¯¯çš„åŒ…ï¼Œä½†æ˜¯ä¸å¸¦æ¥çš„å¥½å¤„ç›¸æ¯”ï¼Œè¿™äº›å¶å°”å‡ºç°çš„é”™è¯¯åœ¨ä½œè€…çœ‹æ¥ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ï¼›å½“ç„¶ï¼Œä¸æƒ³ä½¿ç”¨ `goimports` çš„å¼€å‘è€…ä¹Ÿä¸€å®šè¦åœ¨ IDE æˆ–è€…ç¼–è¾‘å™¨ä¸­å¼€å¯è‡ªåŠ¨åœ° `gofmt` ï¼ˆä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼‰ã€‚

> åœ¨ IDE å’Œ `CI` æ£€æŸ¥ä¸­å¼€å¯è‡ªåŠ¨åœ° `gofmt` æˆ–è€… `goimports` æ£€æŸ¥æ˜¯æ²¡æœ‰ã€ä¹Ÿä¸åº”è¯¥æœ‰è®¨è®ºçš„å¿…è¦çš„ï¼Œè¿™å°±æ˜¯ä¸€ä»¶ä½¿ç”¨å’Œå¼€å‘ Go è¯­è¨€å¿…é¡»è¦åšçš„äº‹æƒ…ã€‚

## golint

å¦ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„é™æ€æ£€æŸ¥å·¥å…·å°±æ˜¯ `golint` äº†ï¼Œä½œä¸ºå®˜æ–¹æä¾›çš„å·¥å…·ï¼Œå®ƒåœ¨å¯å®šåˆ¶åŒ–ä¸Šæœ‰ç€éå¸¸å·®çš„æ”¯æŒï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡å¦‚ä¸‹æ‰€ç¤ºçš„æ–¹å¼è¿è¡Œ `golint` å¯¹æˆ‘ä»¬çš„é¡¹ç›®è¿›è¡Œæ£€æŸ¥ï¼š

```sh
$ golint ./pkg/...
pkg/liquidity/liquidity_pool.go:18:2: exported var ErrOrderBookNotFound should have comment or be unexported
pkg/liquidity/liquidity_pool.go:23:6: exported type LiquidityPool should have comment or be unexported
pkg/liquidity/liquidity_pool.go:23:6: type name will be used as liquidity.LiquidityPool by other packages, and that stutters; consider calling this Pool
pkg/liquidity/liquidity_pool.go:31:1: exported function NewLiquidityPool should have comment or be unexported
...
```

ç¤¾åŒºä¸Šæœ‰å…³äº `golint` å®šåˆ¶åŒ–çš„ è®¨è®ºï¼Œ `golint` çš„å¼€å‘è€…ç»™å‡ºäº†ä»¥ä¸‹çš„å‡ ä¸ªè§‚ç‚¹è§£é‡Šä¸ºä»€ä¹ˆ `golint` ä¸æ”¯æŒå®šåˆ¶åŒ–çš„åŠŸèƒ½ï¼š

- lint çš„ç›®çš„å°±æ˜¯åœ¨ Go è¯­è¨€ç¤¾åŒºä¸­é¼“åŠ±ç»Ÿä¸€ã€ä¸€è‡´çš„ç¼–ç¨‹é£æ ¼ï¼ŒæŸäº›å¼€å‘è€…ä¹Ÿè®¸ä¸ä¼šåŒæ„å…¶ä¸­çš„æŸäº›è§„èŒƒï¼Œä½†æ˜¯ä½¿ç”¨ç»Ÿä¸€çš„é£æ ¼å¯¹äº Go è¯­è¨€ç¤¾åŒºæœ‰æ¯”è¾ƒå¼ºçš„å¥½å¤„ï¼Œè€Œèƒ½å¤Ÿå¼€å…³æŒ‡å®šè§„åˆ™çš„åŠŸèƒ½ä¼šå¯¼è‡´ `golint` ä¸èƒ½å¤Ÿæœ‰æ•ˆåœ°å®Œæˆè¿™ä¸ªå·¥ä½œï¼›
- æœ‰ä¸€äº›é™æ€æ£€æŸ¥çš„è§„åˆ™ä¼šå¯¼è‡´ä¸€äº›é”™è¯¯çš„è­¦å‘Šï¼Œè¿™äº›æƒ…å†µç¡®å®éå¸¸è®©äººå¤´ç–¼ï¼Œä½†æ˜¯æˆ‘ä¼šé€‰æ‹©æ”¯æŒåœ¨ `golint` ä¸­ç›´æ¥ä¿ç•™æˆ–è€…åˆ é™¤è¿™äº›è§„åˆ™ï¼Œè€Œä¸æ˜¯æä¾›éšæ„å¢åˆ è§„åˆ™çš„èƒ½åŠ›ï¼›
- èƒ½å¤Ÿé€šè¿‡ `min_confidence` è¿‡æ»¤ä¸€äº›é™æ€æ£€æŸ¥è§„åˆ™ï¼Œä½†æ˜¯éœ€è¦æˆ‘ä»¬é€‰æ‹©åˆé€‚çš„å€¼ï¼›

`golint` ä½œè€…çš„è§‚ç‚¹åœ¨ issue ä¸­å¾—åˆ°äº†éå¸¸å¤šçš„ ğŸ‘ï¼Œä½†æ˜¯è¿™ä»¶äº‹æƒ…å¾ˆéš¾è¯´å¯¹é”™ï¼›åœ¨ç¤¾åŒºä¸­ä¿è¯ä¸€è‡´çš„ç¼–ç¨‹è§„èŒƒæ˜¯ä¸€ä»¶éå¸¸æœ‰ç›Šçš„äº‹æƒ…ï¼Œä¸è¿‡å¯¹äºå¾ˆå¤šå…¬å¸å†…éƒ¨çš„æœåŠ¡æˆ–è€…é¡¹ç›®ï¼Œå¯èƒ½åœ¨ä¸šåŠ¡æœåŠ¡ä¸Šå°±ä¼šå‘ç”Ÿä¸€äº›æ¯”è¾ƒæ£˜æ‰‹çš„æƒ…å†µï¼Œä½¿ç”¨è¿™ç§è¿‡å¼ºçš„çº¦æŸæ²¡æœ‰å¤ªå¤šæ˜æ˜¾åœ°æ”¶ç›Šã€‚

![golang-lint](https://img.draveness.me/golang-lint.png)

æ›´æ¨èçš„æ–¹æ³•æ˜¯åœ¨åŸºç¡€åº“æˆ–è€…æ¡†æ¶ä¸­ä½¿ç”¨ `golint` è¿›è¡Œé™æ€æ£€æŸ¥ï¼ˆæˆ–è€…åŒæ—¶ä½¿ç”¨ `golint` å’Œ `golangci-lint`ï¼‰ï¼Œåœ¨å…¶ä»–çš„é¡¹ç›®ä¸­ä½¿ç”¨å¯å®šåˆ¶åŒ–çš„ `golangci-lint` æ¥è¿›è¡Œé™æ€æ£€æŸ¥ï¼Œå› ä¸ºåœ¨åŸºç¡€åº“å’Œæ¡†æ¶ä¸­æ–½åŠ å¼ºé™åˆ¶å¯¹äºæ•´ä½“çš„ä»£ç è´¨é‡æœ‰ç€æ›´å¤§çš„æ”¶ç›Šã€‚

ä½œè€…ä¼šåœ¨è‡ªå·±çš„ Go é¡¹ç›®ä¸­ä½¿ç”¨ `golint + golangci-lint` å¹¶å¼€å¯å…¨éƒ¨çš„æ£€æŸ¥å°½é‡å°½æ—©å‘ç°ä»£ç ä¸­åŒ…å«æ–‡æ¡£åœ¨å†…çš„å…¨éƒ¨ç¼ºé™·ã€‚

## è‡ªåŠ¨åŒ–

æ— è®ºæ˜¯ç”¨äºæ£€æŸ¥ä»£ç è§„èŒƒå’Œä¾èµ–åŒ…çš„ `goimports` è¿˜æ˜¯é™æ€æ£€æŸ¥å·¥å…· `glint` æˆ–è€… `golangci-lint`ï¼Œåªè¦æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¼•å…¥è¿™äº›å·¥å…·å°±ä¸€å®šè¦åœ¨ä»£ç çš„ `CI` æµç¨‹ä¸­åŠ å…¥å¯¹åº”çš„è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼š

- åœ¨ GitHub ä¸Šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Travis CI æˆ–è€… CircleCIï¼›
- åœ¨ Gitlab ä¸Šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Gitlab CIï¼›

åœ¨è‡ªå»ºçš„æˆ–è€…å…¶ä»–çš„ä»£ç æ‰˜ç®¡å¹³å°ä¸Šä¹Ÿåº”è¯¥æƒ³å°½åŠæ³•å¯»æ‰¾åˆé€‚çš„å·¥å…·ï¼Œç°ä»£çš„ä»£ç æ‰˜ç®¡å·¥å…·åº”è¯¥éƒ½ä¼šå¯¹ `CI/CD` æœ‰ç€éå¸¸ä¸é”™çš„æ”¯æŒï¼›æˆ‘ä»¬éœ€è¦é€šè¿‡è¿™äº› `CI` å·¥å…·å°†ä»£ç çš„è‡ªåŠ¨åŒ–æ£€æŸ¥å˜æˆ `PR` åˆå¹¶å’Œå‘ç‰ˆçš„ä¸€ä¸ªå‰ç½®æ¡ä»¶ï¼Œå‡å°‘å·¥ç¨‹å¸ˆ `Review` ä»£ç æ—¶å¯èƒ½å‘ç”Ÿçš„ç–æ¼ã€‚

# æœ€ä½³å®è·µ

æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­ä»‹ç»äº†ä¸€äº›èƒ½é€šè¿‡è‡ªåŠ¨åŒ–å·¥å…·å‘ç°çš„é—®é¢˜ï¼Œè¿™ä¸€èŠ‚æåˆ°çš„æœ€ä½³å®è·µå¯èƒ½å°±æ²¡æœ‰åŠæ³•é€šè¿‡è‡ªåŠ¨åŒ–å·¥å…·è¿›è¡Œä¿è¯ï¼Œè¿™äº›æœ€ä½³å®è·µæ›´åƒæ˜¯ Go è¯­è¨€ç¤¾åŒºå†…éƒ¨å‘å±•è¿‡ç¨‹ä¸­ç§¯ç´¯çš„ä¸€äº›å·¥ç¨‹ç»éªŒå’Œå…±è¯†ï¼Œéµå¾ªè¿™äº›æœ€ä½³å®è·µèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å†™å‡ºç¬¦åˆ Go è¯­è¨€ã€å‘³é“ã€çš„ä»£ç ï¼Œæˆ‘ä»¬å°†åœ¨è¿™ä¸€å°èŠ‚è¦†ç›–ä»¥ä¸‹çš„å‡ éƒ¨åˆ†å†…å®¹ï¼š

- ç›®å½•ç»“æ„ï¼›
- æ¨¡å—æ‹†åˆ†ï¼›
- æ˜¾å¼è°ƒç”¨ï¼›
- é¢å‘æ¥å£ï¼›

è¿™å››éƒ¨åˆ†å†…å®¹æ˜¯åœ¨ç¤¾åŒºä¸­ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¸¸è§çš„çº¦å®šï¼Œå¦‚æœæˆ‘ä»¬å­¦ä¹ å¹¶éµå¾ªäº†è¿™äº›çº¦å®šï¼ŒåŒæ—¶åœ¨ Go è¯­è¨€çš„é¡¹ç›®ä¸­å®è·µè¿™å‡ éƒ¨åˆ†å†…å®¹ï¼Œç›¸ä¿¡ä¸€å®šä¼šå¯¹æˆ‘ä»¬è®¾è®¡ Go è¯­è¨€é¡¹ç›®æœ‰æ‰€å¸®åŠ©ã€‚

## ç›®å½•ç»“æ„

ç›®å½•ç»“æ„åŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªé¡¹ç›®çš„é—¨é¢ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä»ç›®å½•ç»“æ„ä¸­å°±èƒ½å¤Ÿçœ‹å‡ºå¼€å‘è€…å¯¹è¿™é—¨è¯­è¨€æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç»éªŒï¼Œæ‰€ä»¥åœ¨è¿™é‡Œé¦–å…ˆè¦ä»‹ç»çš„æœ€ä½³å®è·µå°±æ˜¯å¦‚ä½•åœ¨ Go è¯­è¨€çš„é¡¹ç›®æˆ–è€…æœåŠ¡ä¸­ç»„ç»‡ä»£ç ã€‚

å®˜æ–¹å¹¶æ²¡æœ‰ç»™å‡ºä¸€ä¸ªæ¨èçš„ç›®å½•åˆ’åˆ†æ–¹å¼ï¼Œå¾ˆå¤šé¡¹ç›®å¯¹äºç›®å½•ç»“æ„çš„åˆ’åˆ†ä¹Ÿéå¸¸éšæ„ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„ï¼Œä½†æ˜¯ç¤¾åŒºä¸­è¿˜æ˜¯æœ‰ä¸€äº›æ¯”è¾ƒå¸¸è§çš„çº¦å®šï¼Œä¾‹å¦‚ï¼š[golang-standards/project-layout](https://github.com/golang-standards/project-layout) é¡¹ç›®ä¸­å°±å®šä¹‰äº†ä¸€ä¸ªæ¯”è¾ƒæ ‡å‡†çš„ç›®å½•ç»“æ„ã€‚

```
â”œâ”€â”€ LICENSE.md
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ api
â”œâ”€â”€ assets
â”œâ”€â”€ build
â”œâ”€â”€ cmd
â”œâ”€â”€ configs
â”œâ”€â”€ deployments
â”œâ”€â”€ docs
â”œâ”€â”€ examples
â”œâ”€â”€ githooks
â”œâ”€â”€ init
â”œâ”€â”€ internal
â”œâ”€â”€ pkg
â”œâ”€â”€ scripts
â”œâ”€â”€ test
â”œâ”€â”€ third_party
â”œâ”€â”€ tools
â”œâ”€â”€ vendor
â”œâ”€â”€ web
â””â”€â”€ website
```

æˆ‘ä»¬åœ¨è¿™é‡Œå°±å…ˆç®€å•ä»‹ç»å…¶ä¸­å‡ ä¸ªæ¯”è¾ƒå¸¸è§å¹¶ä¸”é‡è¦çš„ç›®å½•å’Œæ–‡ä»¶ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç†è§£å¦‚ä½•ä½¿ç”¨å¦‚ä¸Šæ‰€ç¤ºçš„ç›®å½•ç»“æ„ï¼Œå¦‚æœå„ä½è¯»è€…æƒ³è¦äº†è§£ä½¿ç”¨å…¶ä»–ç›®å½•çš„åŸå› ï¼Œå¯ä»¥ä» [golang-standards/project-layout](https://github.com/golang-standards/project-layout) é¡¹ç›®ä¸­çš„ `README` äº†è§£æ›´è¯¦ç»†çš„å†…å®¹ã€‚

### /pkg
`/pkg` ç›®å½•æ˜¯ Go è¯­è¨€é¡¹ç›®ä¸­éå¸¸å¸¸è§çš„ç›®å½•ï¼Œæˆ‘ä»¬å‡ ä¹èƒ½å¤Ÿåœ¨æ‰€æœ‰çŸ¥åçš„å¼€æºé¡¹ç›®ï¼ˆéæ¡†æ¶ï¼‰ä¸­æ‰¾åˆ°å®ƒçš„èº«å½±ï¼Œä¾‹å¦‚ï¼š

- prometheus ä¸ŠæŠ¥å’Œå­˜å‚¨æŒ‡æ ‡çš„æ—¶åºæ•°æ®åº“
- istio æœåŠ¡ç½‘æ ¼ 2.0
- kubernetes å®¹å™¨è°ƒåº¦ç®¡ç†ç³»ç»Ÿ
- grafana å±•ç¤ºç›‘æ§å’ŒæŒ‡æ ‡çš„ä»ªè¡¨ç›˜

è¿™ä¸ªç›®å½•ä¸­å­˜æ”¾çš„å°±æ˜¯é¡¹ç›®ä¸­å¯ä»¥è¢«å¤–éƒ¨åº”ç”¨ä½¿ç”¨çš„ä»£ç åº“ï¼Œå…¶ä»–çš„é¡¹ç›®å¯ä»¥ç›´æ¥é€šè¿‡ `import` å¼•å…¥è¿™é‡Œçš„ä»£ç ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬å°†ä»£ç æ”¾å…¥ `pkg` æ—¶ä¸€å®šè¦æ…é‡ï¼Œä¸è¿‡å¦‚æœæˆ‘ä»¬å¼€å‘çš„æ˜¯ `HTTP` æˆ–è€… `RPC` çš„æ¥å£æœåŠ¡æˆ–è€…å…¬å¸çš„å†…éƒ¨æœåŠ¡ï¼Œå°†ç§æœ‰å’Œå…¬æœ‰çš„ä»£ç éƒ½æ”¾åˆ° `/pkg` ä¸­ä¹Ÿæ²¡æœ‰å¤ªå¤šçš„ä¸å¦¥ï¼Œå› ä¸ºä½œä¸ºæœ€é¡¶å±‚çš„é¡¹ç›®æ¥è¯´å¾ˆå°‘ä¼šè¢«å…¶ä»–åº”ç”¨ç›´æ¥ä¾èµ–ï¼Œå½“ç„¶ä¸¥æ ¼éµå¾ªå…¬æœ‰å’Œç§æœ‰ä»£ç åˆ’åˆ†æ˜¯éå¸¸å¥½çš„åšæ³•ï¼Œä½œè€…ä¹Ÿå»ºè®®å„ä½å¼€å‘è€…å¯¹é¡¹ç›®ä¸­å…¬æœ‰å’Œç§æœ‰çš„ä»£ç è¿›è¡Œå¦¥å–„çš„åˆ’åˆ†ã€‚

### ç§æœ‰ä»£ç 

ç§æœ‰ä»£ç æ¨èæ”¾åˆ° `/internal` ç›®å½•ä¸­ï¼ŒçœŸæ­£çš„é¡¹ç›®ä»£ç åº”è¯¥å†™åœ¨ `/internal/app` é‡Œï¼ŒåŒæ—¶è¿™äº›å†…éƒ¨åº”ç”¨ä¾èµ–çš„ä»£ç åº“åº”è¯¥åœ¨ `/internal/pkg` å­ç›®å½•å’Œ `/pkg` ä¸­ï¼Œä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªä½¿ç”¨ `/internal` ç›®å½•çš„é¡¹ç›®ç»“æ„ï¼š

![golang-internal-app-and-pkg](https://img.draveness.me/golang-internal-app-and-pkg.png)

å½“æˆ‘ä»¬åœ¨å…¶ä»–é¡¹ç›®å¼•å…¥åŒ…å« `internal` çš„ä¾èµ–æ—¶ï¼ŒGo è¯­è¨€ä¼šåœ¨ç¼–è¯‘æ—¶æŠ¥é”™ï¼š

```
An import of a path containing the element â€œinternalâ€ is disallowed
if the importing code is outside the tree rooted at the parent of the 
"internal" directory.
```

è¿™ç§é”™è¯¯åªæœ‰åœ¨è¢«å¼•å…¥çš„ `internal` åŒ…ä¸å­˜åœ¨äºå½“å‰é¡¹ç›®æ ‘ä¸­æ‰ä¼šå‘ç”Ÿï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­å¼•å…¥è¯¥é¡¹ç›®çš„ `internal` åŒ…å¹¶ä¸ä¼šå‡ºç°è¿™ç§é”™è¯¯ã€‚

### /src

åœ¨ Go è¯­è¨€çš„é¡¹ç›®æœ€ä¸åº”è¯¥æœ‰çš„ç›®å½•ç»“æ„å…¶å®å°±æ˜¯ `/src` äº†ï¼Œç¤¾åŒºä¸­çš„ä¸€äº›é¡¹ç›®ç¡®å®æœ‰ `/src` æ–‡ä»¶å¤¹ï¼Œä½†æ˜¯è¿™äº›é¡¹ç›®çš„å¼€å‘è€…ä¹‹å‰å¤§å¤šæ•°éƒ½æœ‰ Java çš„ç¼–ç¨‹ç»éªŒï¼Œè¿™åœ¨ Java å’Œå…¶ä»–è¯­è¨€ä¸­å…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„ä»£ç ç»„ç»‡æ–¹å¼ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ª Go è¯­è¨€çš„å¼€å‘è€…ï¼Œæˆ‘ä»¬ä¸åº”è¯¥å…è®¸é¡¹ç›®ä¸­å­˜åœ¨ `/src` ç›®å½•ã€‚

æœ€é‡è¦çš„åŸå› å…¶å®æ˜¯ Go è¯­è¨€çš„é¡¹ç›®åœ¨é»˜è®¤æƒ…å†µä¸‹éƒ½ä¼šè¢«æ”¾ç½®åˆ° `$GOPATH/src` ç›®å½•ä¸‹ï¼Œè¿™ä¸ªç›®å½•ä¸­å­˜å‚¨ç€æˆ‘ä»¬å¼€å‘å’Œä¾èµ–çš„å…¨éƒ¨é¡¹ç›®ä»£ç ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨ `/src` ç›®å½•ï¼Œè¯¥é¡¹ç›®çš„ `PATH` ä¸­å°±ä¼šå‡ºç°ä¸¤ä¸ª `src`ï¼š

```
$GOPATH/src/github.com/draveness/project/src/code.go
```

ä¸Šé¢çš„ç›®å½•ç»“æ„çœ‹èµ·æ¥éå¸¸å¥‡æ€ªï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ Go è¯­è¨€ä¸­ä¸å»ºè®®ä½¿ç”¨ `/src` ç›®å½•çš„æœ€é‡è¦åŸå› ã€‚

å½“ç„¶å“ªæ€•æˆ‘ä»¬åœ¨ Go è¯­è¨€çš„é¡¹ç›®ä¸­ä½¿ç”¨ `/src` ç›®å½•ä¹Ÿä¸ä¼šå¯¼è‡´ç¼–è¯‘ä¸é€šè¿‡æˆ–è€…å…¶ä»–é—®é¢˜ï¼Œå¦‚æœåšæŒè¿™ç§åšæ³•å¯¹äºé¡¹ç›®çš„å¯ç”¨æ€§ä¹Ÿæ²¡æœ‰ä»»ä½•çš„å½±å“ï¼Œä½†æ˜¯å¦‚æœæƒ³è®©æˆ‘ä»¬ã€çœ‹èµ·æ¥ã€æ›´ä¸“ä¸šï¼Œè¿˜æ˜¯éµå¾ªç¤¾åŒºä¸­æ—¢å®šçš„çº¦å®šå‡å°‘å…¶ä»– Go è¯­è¨€å¼€å‘è€…çš„ç†è§£æˆæœ¬ï¼Œè¿™å¯¹äºç¤¾åŒºæ¥è¯´æ˜¯ä¸€ä»¶å¥½äº‹ã€‚

### å¹³é“º

å¦ä¸€ç§åœ¨ Go è¯­è¨€ä¸­ç»„ç»‡ä»£ç çš„æ–¹å¼å°±æ˜¯é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ”¾é¡¹ç›®çš„ä»£ç ï¼Œè¿™ç§æ–¹å¼åœ¨å¾ˆå¤šæ¡†æ¶æˆ–è€…åº“ä¸­éå¸¸å¸¸è§ï¼Œå¦‚æœæƒ³è¦å¼•å…¥ä¸€ä¸ªä½¿ç”¨ `pkg` ç›®å½•ç»“æ„çš„æ¡†æ¶æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦ä½¿ç”¨ `github.com/draveness/project/pkg/somepkg`ï¼Œå½“ä»£ç éƒ½å¹³é“ºåœ¨é¡¹ç›®çš„æ ¹ç›®å½•æ—¶åªéœ€è¦ä½¿ç”¨ `github.com/draveness/project`ï¼Œå¾ˆæ˜æ˜¾åœ°å‡å°‘äº†å¼•ç”¨ä¾èµ–åŒ…è¯­å¥çš„é•¿åº¦ã€‚

æ‰€ä»¥å¯¹äºä¸€ä¸ª Go è¯­è¨€çš„æ¡†æ¶æˆ–è€…åº“ï¼Œå°†ä»£ç å¹³é“ºåœ¨æ ¹ç›®å½•ä¸‹ä¹Ÿå¾ˆæ­£å¸¸ï¼Œä½†æ˜¯åœ¨ä¸€ä¸ª Go è¯­è¨€çš„æœåŠ¡ä¸­ä½¿ç”¨è¿™ç§ä»£ç ç»„ç»‡æ–¹æ³•å¯èƒ½å°±æ²¡æœ‰é‚£ä¹ˆåˆé€‚äº†ã€‚

### /cmd

`/cmd` ç›®å½•ä¸­å­˜å‚¨çš„éƒ½æ˜¯å½“å‰é¡¹ç›®ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¯¥ç›®å½•ä¸‹çš„æ¯ä¸€ä¸ªå­ç›®å½•éƒ½åº”è¯¥åŒ…å«æˆ‘ä»¬å¸Œæœ›æœ‰çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬çš„é¡¹ç›®æ˜¯ä¸€ä¸ª grpc æœåŠ¡çš„è¯ï¼Œå¯èƒ½åœ¨ `/cmd/server/main.go` ä¸­å°±åŒ…å«äº†å¯åŠ¨æœåŠ¡è¿›ç¨‹çš„ä»£ç ï¼Œç¼–è¯‘åç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å°±æ˜¯ `server` ã€‚

æˆ‘ä»¬ä¸åº”è¯¥åœ¨ `/cmd` ç›®å½•ä¸­æ”¾ç½®å¤ªå¤šçš„ä»£ç ï¼Œæˆ‘ä»¬åº”è¯¥å°†å…¬æœ‰ä»£ç æ”¾ç½®åˆ° /pkg ä¸­å¹¶å°†ç§æœ‰ä»£ç æ”¾ç½®åˆ° `/internal` ä¸­å¹¶åœ¨ `/cmd` ä¸­å¼•å…¥è¿™äº›åŒ…ï¼Œä¿è¯ `main` å‡½æ•°ä¸­çš„ä»£ç å°½å¯èƒ½ç®€å•å’Œå°‘ã€‚

### /api

`/api` ç›®å½•ä¸­å­˜æ”¾çš„å°±æ˜¯å½“å‰é¡¹ç›®å¯¹å¤–æä¾›çš„å„ç§ä¸åŒç±»å‹çš„ API æ¥å£å®šä¹‰æ–‡ä»¶äº†ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«ç±»ä¼¼ `/api/protobuf-spec`ã€`/api/thrift-spec` æˆ–è€… `/api/http-spec` çš„ç›®å½•ï¼Œè¿™äº›ç›®å½•ä¸­åŒ…å«äº†å½“å‰é¡¹ç›®å¯¹å¤–æä¾›çš„å’Œä¾èµ–çš„æ‰€æœ‰ API æ–‡ä»¶ï¼š

```sh
$ tree ./api
api
â””â”€â”€ protobuf-spec
    â””â”€â”€ oceanbookpb
        â”œâ”€â”€ oceanbook.pb.go
        â””â”€â”€ oceanbook.proto
```

äºŒçº§ç›®å½•çš„ä¸»è¦ä½œç”¨å°±æ˜¯åœ¨ä¸€ä¸ªé¡¹ç›®åŒæ—¶æä¾›äº†å¤šç§ä¸åŒçš„è®¿é—®æ–¹å¼æ—¶ï¼Œç”¨è¿™ç§åŠæ³•é¿å…å¯èƒ½å­˜åœ¨çš„æ½œåœ¨å†²çªé—®é¢˜ï¼Œä¹Ÿå¯ä»¥è®©é¡¹ç›®ç»“æ„çš„ç»„ç»‡æ›´åŠ æ¸…æ™°ã€‚

### Makefile

æœ€åè¦ä»‹ç»çš„ `Makefile` æ–‡ä»¶ä¹Ÿéå¸¸å€¼å¾—è¢«å…³æ³¨ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªé¡¹ç›®ä¸­éƒ½ä¼šå­˜åœ¨ä¸€äº›éœ€è¦è¿è¡Œçš„è„šæœ¬ï¼Œè¿™äº›è„šæœ¬æ–‡ä»¶åº”è¯¥è¢«æ”¾åˆ° `/scripts` ç›®å½•ä¸­å¹¶ç”± `Makefile` è§¦å‘ï¼Œå°†è¿™äº›ç»å¸¸éœ€è¦è¿è¡Œçš„å‘½ä»¤å›ºåŒ–æˆè„šæœ¬å‡å°‘ã€`ç¥–ä¼ å‘½ä»¤`ã€çš„å‡ºç°ã€‚

### å°ç»“

æ€»çš„æ¥è¯´ï¼Œæ¯ä¸€ä¸ªé¡¹ç›®éƒ½åº”è¯¥æŒ‰ç…§å›ºå®šçš„ç»„ç»‡æ–¹å¼è¿›è¡Œå®ç°ï¼Œè¿™ç§çº¦å®šè™½ç„¶å¹¶ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œä½†æ˜¯æ— è®ºæ˜¯ç»„å†…ã€å…¬å¸å†…è¿˜æ˜¯æ•´ä¸ª Go è¯­è¨€ç¤¾åŒºä¸­ï¼Œåªè¦è¾¾æˆäº†ä¸€è‡´ï¼Œå¯¹äºå…¶ä»–å·¥ç¨‹å¸ˆå¿«é€Ÿæ¢³ç†å’Œç†è§£é¡¹ç›®éƒ½æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚

è¿™ä¸€èŠ‚ä»‹ç»çš„ Go è¯­è¨€é¡¹ç›®çš„ç»„ç»‡æ–¹å¼ä¹Ÿå¹¶ä¸æ˜¯å¼ºåˆ¶è¦æ±‚çš„ï¼Œè¿™åªæ˜¯ Go è¯­è¨€ç¤¾åŒºä¸­ç»å¸¸å‡ºç°çš„é¡¹ç›®ç»„ç»‡æ–¹å¼ï¼Œä¸€ä¸ªå¤§å‹é¡¹ç›®åœ¨ä½¿ç”¨è¿™ç§ç›®å½•ç»“æ„æ—¶ä¹Ÿä¼šå¯¹å…¶è¿›è¡Œå¾®è°ƒï¼Œä¸è¿‡è¿™ç§ç»„ç»‡æ–¹å¼ç¡®å®æ›´ä¸ºå¸¸è§å¹¶ä¸”åˆç†ã€‚

## æ¨¡å—æ‹†åˆ†

æˆ‘ä»¬æ—¢ç„¶å·²ç»ä»‹ç»è¿‡äº†å¦‚ä½•ä»é¡¶å±‚å¯¹é¡¹ç›®çš„ç»“æ„è¿›è¡Œç»„ç»‡ï¼Œæ¥ä¸‹æ¥å°±ä¼šæ·±å…¥åˆ°é¡¹ç›®çš„å†…éƒ¨ä»‹ç» Go è¯­è¨€å¯¹æ¨¡å—çš„ä¸€äº›æ‹†åˆ†æ–¹æ³•ã€‚

Go è¯­è¨€çš„ä¸€äº›é¡¶å±‚è®¾è®¡æœ€ç»ˆå¯¼è‡´äº†å®ƒåœ¨åˆ’åˆ†æ¨¡å—ä¸Šä¸å…¶ä»–çš„ç¼–ç¨‹è¯­è¨€æœ‰ç€éå¸¸æ˜æ˜¾çš„ä¸åŒï¼Œå¾ˆå¤šå…¶ä»–è¯­è¨€çš„ `Web` æ¡†æ¶éƒ½é‡‡ç”¨ `MVC` çš„æ¶æ„æ¨¡å¼ï¼Œä¾‹å¦‚ `Rails` å’Œ `Spring MVC`ï¼ŒGo è¯­è¨€å¯¹æ¨¡å—åˆ’åˆ†çš„æ–¹æ³•å°±ä¸ `Ruby` å’Œ `Java` å®Œå…¨ä¸åŒã€‚

### æŒ‰å±‚æ‹†åˆ†

æ— è®ºæ˜¯ Java è¿˜æ˜¯ Rubyï¼Œå®ƒä»¬æœ€è‘—åçš„æ¡†æ¶éƒ½æ·±å— [MVC æ¶æ„æ¨¡å¼](https://draveness.me/mvx) çš„å½±å“ï¼Œæˆ‘ä»¬ä» `Spring MVC` çš„åå­—ä¸­å°±èƒ½ä½“ä¼šåˆ° MVC å¯¹å®ƒçš„å½±å“ï¼Œè€Œ Ruby ç¤¾åŒºçš„ Rails æ¡†æ¶ä¹Ÿä¸ MVC çš„å…³ç³»éå¸¸ç´§å¯†ï¼Œè¿™æ˜¯ä¸€ç§ Web æ¡†æ¶çš„æœ€å¸¸è§æ¶æ„æ–¹å¼ï¼Œå°†æœåŠ¡ä¸­çš„ä¸åŒç»„ä»¶åˆ†æˆäº† `Model` ã€ `View` å’Œ `Controller` ä¸‰å±‚ã€‚

![divide-by-laye](https://img.draveness.me/divide-by-layer.jpg)

è¿™ç§æ¨¡å—æ‹†åˆ†çš„æ–¹å¼å…¶å®å°±æ˜¯æŒ‰ç…§å±‚çº§è¿›è¡Œæ‹†åˆ†ï¼ŒRails è„šæ‰‹æ¶é»˜è®¤ç”Ÿæˆçš„ä»£ç å…¶å®å°±æ˜¯å°†è¿™ä¸‰å±‚ä¸åŒçš„æºæ–‡ä»¶æ”¾åœ¨å¯¹åº”çš„ç›®å½•ä¸‹ï¼š`models`ã€ `views` å’Œ `controllers` ï¼Œæˆ‘ä»¬é€šè¿‡ rails new example ç”Ÿæˆä¸€ä¸ªæ–°çš„ Rails é¡¹ç›®åå¯ä»¥çœ‹åˆ°å…¶ä¸­çš„ç›®å½•ç»“æ„ï¼š

```sh
$ tree -L 2 app
app
â”œâ”€â”€ controllers
â”‚   â”œâ”€â”€ application_controller.rb
â”‚   â””â”€â”€ concerns
â”œâ”€â”€ models
â”‚   â”œâ”€â”€ application_record.rb
â”‚   â””â”€â”€ concerns
â””â”€â”€ views
    â””â”€â”€ layouts
```

è€Œå¾ˆå¤š Spring MVC çš„é¡¹ç›®ä¸­ä¹Ÿä¼šå‡ºç°ç±»ä¼¼ `modelã€daoã€view` çš„ç›®å½•ï¼Œè¿™ç§æŒ‰å±‚æ‹†åˆ†æ¨¡å—çš„è®¾è®¡å…¶å®æœ‰ä»¥ä¸‹çš„å‡ æ–¹é¢åŸå› ï¼š

- MVC æ¶æ„æ¨¡å¼ â€” MVC æœ¬èº«å°±å¼ºè°ƒäº†æŒ‰å±‚åˆ’åˆ†èŒè´£çš„è®¾è®¡ï¼Œæ‰€ä»¥éµå¾ªè¯¥æ¨¡å¼è®¾è®¡çš„æ¡†æ¶è‡ªç„¶æœ‰ç€ä¸€è„‰ç›¸æ‰¿çš„æ€è·¯ï¼›
- æ‰å¹³çš„å‘½åç©ºé—´ â€” æ— è®ºæ˜¯ Spring MVC è¿˜æ˜¯ Railsï¼ŒåŒä¸€ä¸ªé¡¹ç›®ä¸­å‘½åç©ºé—´éå¸¸æ‰å¹³ï¼Œè·¨æ–‡ä»¶å¤¹ä½¿ç”¨å…¶ä»–æ–‡ä»¶å¤¹ä¸­å®šä¹‰çš„ç±»æˆ–è€…æ–¹æ³•ä¸éœ€è¦å¼•å…¥æ–°çš„åŒ…ï¼Œä½¿ç”¨å…¶ä»–æ–‡ä»¶å®šä¹‰çš„ç±»æ—¶ä¹Ÿä¸éœ€è¦å¢åŠ é¢å¤–çš„å‰ç¼€ï¼Œå¤šä¸ªæ–‡ä»¶å®šä¹‰çš„ç±»è¢«ã€åˆå¹¶ã€åˆ°äº†åŒä¸€ä¸ªå‘½åç©ºé—´ä¸­ï¼›
- å•ä½“æœåŠ¡çš„åœºæ™¯ â€” Spring MVC å’Œ Rails åˆšå‡ºç°æ—¶ï¼ŒSOA å’Œå¾®æœåŠ¡æ¶æ„è¿˜ä¸åƒä»Šå¤©è¿™ä¹ˆæ™®éï¼Œç»å¤§å¤šæ•°çš„åœºæ™¯ä¹Ÿä¸éœ€è¦é€šè¿‡æ‹†åˆ†æœåŠ¡ï¼›

ä¸Šé¢çš„å‡ ä¸ªåŸå› å…±åŒå†³å®šäº† Spring MVC å’Œ Rails ä¼šå‡ºç° `models` ã€ `views` å’Œ `controllers` çš„ç›®å½•å¹¶æŒ‰ç…§å±‚çº§çš„æ–¹å¼å¯¹æ¨¡å—è¿›è¡Œæ‹†åˆ†ã€‚

### æŒ‰èŒè´£æ‹†åˆ†

Go è¯­è¨€åœ¨æ‹†åˆ†æ¨¡å—æ—¶å°±ä½¿ç”¨äº†å®Œå…¨ä¸åŒçš„æ€è·¯ï¼Œè™½ç„¶ `MVC` æ¶æ„æ¨¡å¼æ˜¯åœ¨æˆ‘ä»¬å†™ Web æœåŠ¡æ—¶æ— æ³•é¿å¼€çš„ï¼Œä½†æ˜¯ç›¸æ¯”äºæ¨ªå‘åœ°åˆ‡åˆ†ä¸åŒçš„å±‚çº§ï¼ŒGo è¯­è¨€çš„é¡¹ç›®å¾€å¾€éƒ½æŒ‰ç…§èŒè´£å¯¹æ¨¡å—è¿›è¡Œæ‹†åˆ†ï¼š

![divide-by-responsibility](https://img.draveness.me/divide-by-responsibility.jpg)

å¯¹äºä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„åšå®¢ç³»ç»Ÿï¼Œä½¿ç”¨ Go è¯­è¨€çš„é¡¹ç›®ä¼šæŒ‰ç…§ä¸åŒçš„èŒè´£å°†å…¶çºµå‘æ‹†åˆ†æˆ `post` ã€ `user` ã€ `comment` ä¸‰ä¸ªæ¨¡å—ï¼Œæ¯ä¸€ä¸ªæ¨¡å—éƒ½å¯¹å¤–æä¾›ç›¸åº”çš„åŠŸèƒ½ï¼Œ `post` æ¨¡å—ä¸­å°±åŒ…å«ç›¸å…³çš„æ¨¡å‹å’Œè§†å›¾å®šä¹‰ä»¥åŠç”¨äºå¤„ç† API è¯·æ±‚çš„æ§åˆ¶å™¨ï¼ˆæˆ–è€…æœåŠ¡ï¼‰ï¼š

```sh
$ tree pkg
pkg
â”œâ”€â”€ comment
â”œâ”€â”€ post
â”‚   â”œâ”€â”€ handler.go
â”‚   â””â”€â”€ post.go
â””â”€â”€ user
```

Go è¯­è¨€é¡¹ç›®ä¸­çš„æ¯ä¸€ä¸ªæ–‡ä»¶ç›®å½•éƒ½ä»£è¡¨ç€ä¸€ä¸ªç‹¬ç«‹çš„å‘½åç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå•ç‹¬çš„åŒ…ï¼Œå½“æˆ‘ä»¬æƒ³è¦å¼•ç”¨å…¶ä»–æ–‡ä»¶å¤¹çš„ç›®å½•æ—¶ï¼Œé¦–å…ˆéœ€è¦ä½¿ç”¨ import å…³é”®å­—å¼•å…¥ç›¸åº”çš„æ–‡ä»¶ç›®å½•ï¼Œå†é€šè¿‡ `pkg.xxx` çš„å½¢å¼å¼•ç”¨å…¶ä»–ç›®å½•å®šä¹‰çš„ç»“æ„ä½“ã€å‡½æ•°æˆ–è€…å¸¸é‡ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ Go è¯­è¨€ä¸­ä½¿ç”¨ `model`ã€`view` å’Œ `controller` æ¥åˆ’åˆ†å±‚çº§ï¼Œä½ ä¼šåœ¨å…¶ä»–çš„æ¨¡å—ä¸­çœ‹åˆ°éå¸¸å¤šçš„ `model.Post`ã€`model.Comment` å’Œ `view.PostView`ã€‚

è¿™ç§åˆ’åˆ†å±‚çº§çš„æ–¹æ³•åœ¨ Go è¯­è¨€ä¸­ä¼šæ˜¾å¾—éå¸¸å†—ä½™ï¼Œå¹¶ä¸”å¦‚æœå¯¹é¡¹ç›®ä¾èµ–åŒ…çš„ç®¡ç†ä¸å¤Ÿè°¨æ…æ—¶ï¼Œå¾ˆå®¹æ˜“å‘ç”Ÿå¼•ç”¨å¾ªç¯ï¼Œå‡ºç°è¿™äº›é—®é¢˜çš„æœ€æ ¹æœ¬åŸå› å…¶å®ä¹Ÿéå¸¸ç®€å•ï¼š

- Go è¯­è¨€å¯¹åŒä¸€ä¸ªé¡¹ç›®ä¸­ä¸åŒç›®å½•çš„å‘½åç©ºé—´åšäº†éš”ç¦»ï¼Œæ•´ä¸ªé¡¹ç›®ä¸­å®šä¹‰çš„ç±»å’Œæ–¹æ³•å¹¶ä¸æ˜¯åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ä¸‹çš„ï¼Œè¿™ä¹Ÿå°±éœ€è¦å·¥ç¨‹å¸ˆè‡ªå·±ç»´æŠ¤ä¸åŒåŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼›
- æŒ‰ç…§èŒè´£å‚ç›´æ‹†åˆ†çš„æ–¹å¼åœ¨å•ä½“æœåŠ¡é‡åˆ°ç“¶é¢ˆæ—¶éå¸¸å®¹æ˜“å¯¹å¾®æœåŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†ä¸€ä¸ªè´Ÿè´£ç‹¬ç«‹åŠŸèƒ½çš„ package æ‹†å‡ºå»ï¼Œå¯¹è¿™éƒ¨åˆ†æ€§èƒ½çƒ­ç‚¹å•ç‹¬è¿›è¡Œæ‰©å®¹ï¼›

### å°ç»“

é¡¹ç›®æ˜¯æŒ‰ç…§å±‚çº§è¿˜æ˜¯æŒ‰ç…§èŒè´£å¯¹æ¨¡å—è¿›è¡Œæ‹†åˆ†å…¶å®å¹¶æ²¡æœ‰ç»å¯¹çš„å¥½ä¸ä¸å¥½ï¼Œè¯­è¨€å’Œæ¡†æ¶å±‚é¢çš„è®¾è®¡æœ€ç»ˆå†³å®šäº†æˆ‘ä»¬åº”è¯¥é‡‡ç”¨å“ªç§æ–¹å¼å¯¹é¡¹ç›®å’Œä»£ç è¿›è¡Œç»„ç»‡ã€‚

Java å’Œ Ruby è¿™äº›è¯­è¨€åœ¨æ¡†æ¶ä¸­å¾€å¾€é‡‡ç”¨æ°´å¹³æ‹†åˆ†çš„æ–¹å¼åˆ’åˆ†ä¸åŒå±‚çº§çš„èŒè´£ï¼Œè€Œ Go è¯­è¨€é¡¹ç›®çš„æœ€ä½³å®è·µå°±æ˜¯æŒ‰ç…§èŒè´£å¯¹æ¨¡å—è¿›è¡Œå‚ç›´æ‹†åˆ†ï¼Œå°†ä»£ç æŒ‰ç…§åŠŸèƒ½çš„æ–¹å¼åˆ†åˆ°å¤šä¸ª `package` ä¸­ï¼Œè¿™å¹¶ä¸æ˜¯è¯´ Go è¯­è¨€ä¸­ä¸å­˜åœ¨æ¨¡å—çš„æ°´å¹³æ‹†åˆ†ï¼Œåªæ˜¯å› ä¸º `package` ä½œä¸ºä¸€ä¸ª Go è¯­è¨€è®¿é—®æ§åˆ¶çš„æœ€å°ç²’åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥éµå¾ªé¡¶å±‚çš„è®¾è®¡ä½¿ç”¨è¿™ç§æ–¹å¼æ„å»ºé«˜å†…èšçš„æ¨¡å—ã€‚

## æ˜¾å¼ä¸éšå¼

ä»å¼€å§‹å­¦ä¹ ã€ä½¿ç”¨ Go è¯­è¨€åˆ°å‚ä¸ç¤¾åŒºä¸Šä¸€äº›å¼€æºçš„ Golang é¡¹ç›®ï¼Œä½œè€…å‘ç° Go è¯­è¨€ç¤¾åŒºå¯¹äºæ˜¾å¼çš„åˆå§‹åŒ–ã€æ–¹æ³•è°ƒç”¨å’Œé”™è¯¯å¤„ç†éå¸¸æ¨å´‡ï¼Œç±»ä¼¼ `Spring Boot` å’Œ `Rails` çš„æ¡†æ¶å…¶å®éƒ½å¹¿æ³›åœ°é‡‡çº³äº†ã€`çº¦å®šä¼˜äºé…ç½®`ã€çš„ä¸­å¿ƒæ€æƒ³ï¼Œç®€åŒ–äº†å¼€å‘è€…å’Œå·¥ç¨‹å¸ˆçš„å·¥ä½œé‡ã€‚

ç„¶è€Œ Go è¯­è¨€ç¤¾åŒºè™½ç„¶è¾¾æˆäº†å¾ˆå¤šçš„å…±è¯†ä¸çº¦å®šï¼Œä½†æ˜¯ä»è¯­è¨€çš„è®¾è®¡ä»¥åŠå·¥å…·ä¸Šçš„ä½¿ç”¨æˆ‘ä»¬å°±èƒ½å‘ç°æ˜¾å¼åœ°è°ƒç”¨æ–¹æ³•å’Œé”™è¯¯å¤„ç†æ˜¯è¢«é¼“åŠ±çš„ã€‚

### init

æˆ‘ä»¬åœ¨è¿™é‡Œå…ˆä»¥ä¸€ä¸ªéå¸¸å¸¸è§çš„å‡½æ•° `init` ä¸ºä¾‹ï¼Œä»‹ç» Go è¯­è¨€ç¤¾åŒºå¯¹æ˜¾å¼è°ƒç”¨çš„æ¨å´‡ï¼›ç›¸ä¿¡å¾ˆå¤šäººéƒ½åœ¨ä¸€äº› `package` ä¸­é˜…è¯»è¿‡è¿™æ ·çš„ä»£ç ï¼š

```go
var grpcClient *grpc.Client

func init() {
    var err error
    grpcClient, err = grpc.Dial(...)
    if err != nil {
        panic(err)
    }
}

func GetPost(postID int64) (*Post, error) {
    post, err := grpcClient.FindPost(context.Background(), &pb.FindPostRequest{PostID: postID})
    if err != nil {
        return nil, err
    }
    
    return post, nil
}
```

è¿™ç§ä»£ç è™½ç„¶èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘å¹¶ä¸”æ­£å¸¸å·¥ä½œï¼Œç„¶è€Œè¿™é‡Œçš„ `init` å‡½æ•°å…¶å®éšå¼åœ°åˆå§‹åŒ–äº† `grpc` çš„è¿æ¥èµ„æºï¼Œå¦‚æœå¦ä¸€ä¸ª `package` ä¾èµ–äº†å½“å‰çš„åŒ…ï¼Œé‚£ä¹ˆå¼•å…¥è¿™ä¸ªä¾èµ–çš„å·¥ç¨‹å¸ˆå¯èƒ½ä¼šåœ¨é‡åˆ°é”™è¯¯æ—¶éå¸¸å›°æƒ‘ï¼Œå› ä¸ºåœ¨ `init` å‡½æ•°ä¸­åšè¿™ç§èµ„æºçš„åˆå§‹åŒ–æ˜¯éå¸¸è€—æ—¶å¹¶ä¸”å®¹æ˜“å‡ºç°é—®é¢˜çš„ã€‚

ä¸€ç§æ›´åŠ åˆç†çš„åšæ³•å…¶å®æ˜¯è¿™æ ·çš„ï¼Œé¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ–°çš„ `Client` ç»“æ„ä½“ä»¥åŠä¸€ä¸ªç”¨äºåˆå§‹åŒ–ç»“æ„çš„ `NewClient` å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶äº†ä¸€ä¸ª `grpc` è¿æ¥ä½œä¸ºå…¥å‚è¿”å›ä¸€ä¸ªç”¨äºè·å– `Post` `èµ„æºçš„å®¢æˆ·ç«¯ï¼ŒGetPost` æˆä¸ºäº†è¿™ä¸ªç»“æ„ä½“çš„æ–¹æ³•ï¼Œæ¯å½“æˆ‘ä»¬è°ƒç”¨ `client.GetPost` æ—¶éƒ½ä¼šç”¨åˆ°ç»“æ„ä½“ä¸­ä¿å­˜çš„ `grpc` è¿æ¥ï¼š

```go
// pkg/post/client.go
type Client struct {
    grpcClient *grpc.ClientConn    
}

func NewClient(grpcClient *grpcClientConn) Client {
    return &Client{
        grpcClient: grpcClient,
    }
}

func (c *Client) GetPost(postID int64) (*Post, error) {
    post, err := c.grpcClient.FindPost(context.Background(), &pb.FindPostRequest{PostID: postID})
    if err != nil {
        return nil, err
    }
    
    return post, nil
}
```

åˆå§‹åŒ– `grpc` è¿æ¥çš„ä»£ç åº”è¯¥æ”¾åˆ° `main` å‡½æ•°æˆ–è€… `main` å‡½æ•°è°ƒç”¨çš„å…¶ä»–å‡½æ•°ä¸­æ‰§è¡Œï¼Œå¦‚æœæˆ‘ä»¬åœ¨ `main` å‡½æ•°ä¸­æ˜¾å¼çš„åˆå§‹åŒ–è¿™ç§ä¾èµ–ï¼Œå¯¹äºå…¶ä»–çš„å·¥ç¨‹å¸ˆæ¥è¯´å°±éå¸¸æ˜“äºç†è§£ï¼Œæˆ‘ä»¬ä» `main` å‡½æ•°å¼€å§‹å°±èƒ½æ¢³ç†å‡ºç¨‹åºå¯åŠ¨çš„æ•´ä¸ªè¿‡ç¨‹ã€‚

```go
// cmd/grpc/main.go
func main() {
    grpcClient, err := grpc.Dial(...)
    if err != nil {
        panic(err)
    }
    
    postClient := post.NewClient(grpcClient)
    // ...
}
```

å„ä¸ªæ¨¡å—ä¹‹é—´ä¼šæ„æˆä¸€ç§æ ‘å½¢çš„ç»“æ„å’Œä¾èµ–å…³ç³»ï¼Œä¸Šå±‚çš„æ¨¡å—ä¼šæŒæœ‰ä¸‹å±‚æ¨¡å—ä¸­çš„æ¥å£æˆ–è€…ç»“æ„ä½“ï¼Œä¸ä¼šå­˜åœ¨å­¤ç«‹çš„ã€ä¸è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚

![golang-project-and-tree-structure](https://img.draveness.me/golang-project-and-tree-structure.jpg)

> ä¸Šå›¾ä¸­å‡ºç°çš„ä¸¤ä¸ª `Database` å…¶å®æ˜¯åœ¨ `main` å‡½æ•°ä¸­åˆå§‹åŒ–çš„æ•°æ®åº“è¿æ¥ï¼Œåœ¨é¡¹ç›®è¿è¡ŒæœŸé—´ï¼Œå®ƒä»¬å¯èƒ½è¡¨ç¤ºåŒä¸€ä¸ªå†…å­˜ä¸­çš„æ•°æ®åº“è¿æ¥

å½“æˆ‘ä»¬ä½¿ç”¨ `golangci-lint` å¹¶å¼€å¯ `gochecknoinits` å’Œ `gochecknoglobals` é™æ€æ£€æŸ¥æ—¶ï¼Œå®ƒå…¶å®ä¸¥æ ¼åœ°é™åˆ¶æˆ‘ä»¬å¯¹ `init` å‡½æ•°å’Œå…¨å±€å˜é‡çš„ä½¿ç”¨ã€‚

å½“ç„¶è¿™å¹¶ä¸æ˜¯è¯´æˆ‘ä»¬ä¸€å®šä¸èƒ½ä½¿ç”¨ `init` å‡½æ•°ï¼Œä½œä¸º Go è¯­è¨€èµ‹äºˆå¼€å‘è€…çš„èƒ½åŠ›ï¼Œå› ä¸ºå®ƒèƒ½åœ¨åŒ…è¢«å¼•å…¥æ—¶éšå¼åœ°æ‰§è¡Œäº†ä¸€äº›ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´åº”è¯¥æ…é‡åœ°ä½¿ç”¨å®ƒä»¬ã€‚

ä¸€äº›æ¡†æ¶ä¼šåœ¨ `init` ä¸­åˆ¤æ–­æ˜¯å¦æ»¡è¶³ä½¿ç”¨çš„å‰ç½®æ¡ä»¶ï¼Œä½†æ˜¯å¯¹äºå¾ˆå¤šçš„ Web æˆ–è€… API æœåŠ¡æ¥è¯´ï¼Œå¤§é‡ä½¿ç”¨ `init` å¾€å¾€æ„å‘³ç€ä»£ç è´¨é‡çš„ä¸‹é™ä»¥åŠä¸åˆç†çš„è®¾è®¡ã€‚

```go
func init() {
    if user == "" {
        log.Fatal("$USER not set")
    }
    if home == "" {
        home = "/home/" + user
    }
    if gopath == "" {
        gopath = home + "/go"
    }
    // gopath may be overridden by --gopath flag on command line.
    flag.StringVar(&gopath, "gopath", gopath, "override default GOPATH")
}
```

ä¸Šè¿°ä»£ç å…¶å®æ˜¯ [Effective Go](https://golang.org/doc/effective_go.html#init) åœ¨ä»‹ç» `init` æ–¹æ³•ä½¿ç”¨æ˜¯å±•ç¤ºçš„å®ä¾‹ä»£ç ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆç†åœ° `init` å‡½æ•°ä½¿ç”¨ç¤ºä¾‹ï¼Œæˆ‘ä»¬ä¸åº”è¯¥åœ¨ `init` ä¸­åšè¿‡é‡çš„åˆå§‹åŒ–é€»è¾‘ï¼Œè€Œæ˜¯åšä¸€äº›ç®€å•ã€è½»é‡çš„å‰ç½®æ¡ä»¶åˆ¤æ–­ã€‚

### error

å¦ä¸€ä¸ªè¦ä»‹ç»çš„å°±æ˜¯ Go è¯­è¨€çš„é”™è¯¯å¤„ç†æœºåˆ¶äº†ï¼Œè™½ç„¶ Golang çš„é”™è¯¯å¤„ç†è¢«å¼€å‘è€…è¯Ÿç—…å·²ä¹…ï¼Œä½†æ˜¯å·¥ç¨‹å¸ˆæ¯å¤©éƒ½åœ¨å†™ `if err != nil { return nil, err }` çš„é”™è¯¯å¤„ç†é€»è¾‘å…¶å®å°±æ˜¯åœ¨æ˜¾å¼åœ°å¯¹é”™è¯¯å¤„ç†ï¼Œå…³æ³¨æ‰€æœ‰å¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯çš„æ–¹æ³•è°ƒç”¨å¹¶åœ¨æ— æ³•å¤„ç†æ—¶æŠ›ç»™ä¸Šå±‚æ¨¡å—ã€‚

```go
func ListPosts(...) ([]Post, error) {
    conn, err := gorm.Open(...)
    if err != nil {
        return []Post{}, err
    }
    
    var posts []Post
    if err := conn.Find(&posts).Error; err != nil {
        return []Post{}, err
    }
    
    return posts, nil
}
```

ä¸Šè¿°ä»£ç åªæ˜¯ç®€å•å±•ç¤º Go è¯­è¨€å¸¸è§çš„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œæˆ‘ä»¬ä¸åº”è¯¥åœ¨è¿™ç§æ–¹æ³•ä¸­åˆå§‹åŒ–æ•°æ®åº“çš„è¿æ¥ã€‚

è™½ç„¶ Golang ä¸­ä¹Ÿæœ‰ç±»ä¼¼ Java æˆ–è€… Ruby `try/catch` å…³é”®å­—ï¼Œä½†æ˜¯å¾ˆå°‘æœ‰äººä¼šåœ¨ä»£ç ä¸­ä½¿ç”¨ `panic` å’Œ `recover` æ¥å®ç°é”™è¯¯å’Œå¼‚å¸¸çš„å¤„ç†ï¼Œä¸ init å‡½æ•°ä¸€æ ·ï¼ŒGo è¯­è¨€å¯¹äº `panic` å’Œ `recover` çš„ä½¿ç”¨ä¹Ÿéå¸¸è°¨æ…ã€‚

å½“æˆ‘ä»¬åœ¨ Go è¯­è¨€ä¸­å¤„ç†é”™è¯¯ç›¸å…³çš„é€»è¾‘æ—¶ï¼Œæœ€é‡è¦çš„å…¶å®å°±æ˜¯ä»¥ä¸‹å‡ ç‚¹ï¼š

- **ä½¿ç”¨ `error` å®ç°é”™è¯¯å¤„ç†** â€” å°½ç®¡è¿™çœ‹èµ·æ¥éå¸¸å•°å—¦ï¼›
- **å°†é”™è¯¯æŠ›ç»™ä¸Šå±‚å¤„ç†** â€” å¯¹äºä¸€ä¸ªæ–¹æ³•æ˜¯å¦éœ€è¦è¿”å› `error` ä¹Ÿéœ€è¦æˆ‘ä»¬ä»”ç»†åœ°æ€è€ƒï¼Œå‘ä¸ŠæŠ›å‡ºé”™è¯¯æ—¶å¯ä»¥é€šè¿‡ `errors.Wrap` æºå¸¦ä¸€äº›é¢å¤–çš„ä¿¡æ¯æ–¹ä¾¿ä¸Šå±‚è¿›è¡Œåˆ¤æ–­ï¼›
- **å¤„ç†æ‰€æœ‰å¯èƒ½è¿”å›çš„é”™è¯¯** â€” æ‰€æœ‰å¯èƒ½è¿”å›é”™è¯¯çš„åœ°æ–¹æœ€ç»ˆä¸€å®šä¼šè¿”å›é”™è¯¯ï¼Œè€ƒè™‘å…¨é¢æ‰èƒ½å¸®åŠ©æˆ‘ä»¬æ„å»ºæ›´åŠ å¥å£®çš„é¡¹ç›®ï¼›

### å°ç»“

ä½œè€…åœ¨ä½¿ç”¨ Go è¯­è¨€çš„è¿™æ®µæ—¶é—´ï¼Œèƒ½å¤Ÿæ·±åˆ»åœ°ä½“ä¼šåˆ°å®ƒå¯¹äºæ˜¾å¼æ–¹æ³•è°ƒç”¨ä¸é”™è¯¯å¤„ç†çš„é¼“åŠ±ï¼Œè¿™ä¸ä»…èƒ½å¤Ÿå¸®åŠ©é¡¹ç›®çš„å…¶ä»–å¼€å‘è€…å¿«é€Ÿåœ°ç†è§£ä¸Šä¸‹æ–‡ï¼Œä¹Ÿèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ„å»ºæ›´åŠ å¥å£®ã€å®¹é”™æ€§ä¸å¯ç»´æŠ¤æ€§æ›´å¥½çš„å·¥ç¨‹ã€‚

## é¢å‘æ¥å£

é¢å‘æ¥å£ç¼–ç¨‹æ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ï¼Œæ¥å£ çš„ä½œç”¨å…¶å®å°±æ˜¯ä¸ºä¸åŒå±‚çº§çš„æ¨¡å—æä¾›äº†ä¸€ä¸ªå®šä¹‰å¥½çš„ä¸­é—´å±‚ï¼Œä¸Šæ¸¸ä¸å†éœ€è¦ä¾èµ–ä¸‹æ¸¸çš„å…·ä½“å®ç°ï¼Œå……åˆ†åœ°å¯¹ä¸Šä¸‹æ¸¸è¿›è¡Œäº†è§£è€¦ã€‚

![golang-interface](https://img.draveness.me/golang-interface.png)

è¿™ç§ç¼–ç¨‹æ–¹å¼ä¸ä»…æ˜¯åœ¨ Go è¯­è¨€ä¸­æ˜¯è¢«æ¨èçš„ï¼Œåœ¨å‡ ä¹æ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šæ¨èè¿™ç§ç¼–ç¨‹çš„æ–¹å¼ï¼Œå®ƒä¸ºæˆ‘ä»¬çš„ç¨‹åºæä¾›äº†éå¸¸å¼ºçš„çµæ´»æ€§ï¼Œæƒ³è¦æ„å»ºä¸€ä¸ªç¨³å®šã€å¥å£®çš„ Go è¯­è¨€é¡¹ç›®ï¼Œä¸ä½¿ç”¨æ¥å£æ˜¯å®Œå…¨æ— æ³•åšåˆ°çš„ã€‚

å¦‚æœä¸€ä¸ªç•¥æœ‰è§„æ¨¡çš„é¡¹ç›®ä¸­æ²¡æœ‰å‡ºç°ä»»ä½• `type ... interface` çš„å®šä¹‰ï¼Œé‚£ä¹ˆä½œè€…å¯ä»¥æ¨æµ‹å‡ºè¿™åœ¨å¾ˆå¤§çš„æ¦‚ç‡ä¸Šæ˜¯ä¸€ä¸ª**å·¥ç¨‹è´¨é‡å ªå¿§å¹¶ä¸”æ²¡æœ‰å¤šå°‘å•å…ƒæµ‹è¯•è¦†ç›–çš„é¡¹ç›®**ï¼Œæˆ‘ä»¬ç¡®å®éœ€è¦è®¤çœŸè€ƒè™‘ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨æ¥å£å¯¹é¡¹ç›®è¿›è¡Œé‡æ„ã€‚

> å•å…ƒæµ‹è¯•æ˜¯ä¸€ä¸ªé¡¹ç›®ä¿è¯å·¥ç¨‹è´¨é‡æœ€æœ‰æ•ˆå¹¶ä¸”æŠ•èµ„å›æŠ¥ç‡æœ€é«˜çš„æ–¹æ³•ä¹‹ä¸€ï¼Œä½œä¸ºé™æ€è¯­è¨€çš„ Golangï¼Œæƒ³è¦å†™å‡ºè¦†ç›–ç‡è¶³å¤Ÿï¼ˆæœ€å°‘è¦†ç›–æ ¸å¿ƒé€»è¾‘ï¼‰çš„å•å…ƒæµ‹è¯•æœ¬èº«å°±æ¯”è¾ƒå›°éš¾ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½åƒåŠ¨æ€è¯­è¨€ä¸€æ ·`éšæ„`ä¿®æ”¹å‡½æ•°å’Œæ–¹æ³•çš„è¡Œä¸ºï¼Œè€Œæ¥å£å°±æˆäº†æˆ‘ä»¬çš„æ•‘å‘½ç¨»è‰ï¼Œå†™å‡ºæŠ½è±¡è‰¯å¥½çš„æ¥å£å¹¶é€šè¿‡æ¥å£éš”ç¦»ä¾èµ–èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆåœ°æå‡é¡¹ç›®çš„è´¨é‡å’Œå¯æµ‹è¯•æ€§ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€èŠ‚ä¸­è¯¦ç»†ä»‹ç»å¦‚ä½•å†™å•å…ƒæµ‹è¯•ã€‚

```go
package post

var client *grpc.ClientConn

func init() {
    var err error
    client, err = grpc.Dial(...ï¼‰
    if err != nil {
        panic(err)
    }
}

func ListPosts() ([]*Post, error) {
    posts, err := client.ListPosts(...)
    if err != nil {
        return []*Post{}, err
    }
    
    return posts, nil
}
```

ä¸Šè¿°ä»£ç å…¶å®å°±ä¸æ˜¯ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ä»£ç ï¼Œå®ƒä¸ä»…åœ¨ `init` å‡½æ•°ä¸­éšå¼åœ°åˆå§‹åŒ–äº† `grpc` è¿æ¥è¿™ç§å…¨å±€å˜é‡ï¼Œè€Œä¸”æ²¡æœ‰å°† `ListPosts` é€šè¿‡æ¥å£çš„æ–¹å¼æš´éœ²å‡ºå»ï¼Œè¿™ä¼šè®©ä¾èµ– `ListPosts` çš„ä¸Šå±‚æ¨¡å—éš¾ä»¥æµ‹è¯•ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ”¹å†™åŸæœ‰çš„é€»è¾‘ï¼Œä½¿å¾—åŒæ ·åœ°é€»è¾‘å˜å¾—æ›´å®¹æ˜“æµ‹è¯•å’Œç»´æŠ¤ï¼š

```go
package post

type Service interface {
    ListPosts() ([]*Post, error)
}

type service struct {
    conn *grpc.ClientConn
}

func NewService(conn *grpc.ClientConn) Service {
    return &service{
        conn: conn,
    }
}

func (s *service) ListPosts() ([]*Post, error) {
    posts, err := s.conn.ListPosts(...)
    if err != nil {
        return []*Post{}, err
    }
    
    return posts, nil
}
```

- é€šè¿‡æ¥å£ `Service` æš´éœ²å¯¹å¤–çš„ `ListPosts` æ–¹æ³•ï¼›
- ä½¿ç”¨ `NewService` å‡½æ•°åˆå§‹åŒ– `Service` æ¥å£çš„å®ç°å¹¶é€šè¿‡ç§æœ‰çš„ç»“æ„ä½“ `service` æŒæœ‰ `grpc` è¿æ¥ï¼›
- `ListPosts` ä¸å†ä¾èµ–å…¨å±€å˜é‡ï¼Œè€Œæ˜¯ä¾èµ–æ¥å£ä½“ `service` æŒæœ‰çš„è¿æ¥ï¼›

å½“æˆ‘ä»¬ä½¿ç”¨è¿™ç§æ–¹å¼é‡æ„ä»£ç ä¹‹åï¼Œå°±å¯ä»¥åœ¨ `main` å‡½æ•°ä¸­æ˜¾å¼çš„åˆå§‹åŒ– `grpc` è¿æ¥ã€åˆ›å»º `Service` æ¥å£çš„å®ç°å¹¶è°ƒç”¨ `ListPosts` æ–¹æ³•ï¼š

```go
package main

import ...

func main() {
    conn, err = grpc.Dial(...ï¼‰
    if err != nil {
        panic(err)
    }
    
    svc := post.NewService(conn)
    posts, err := svc.ListPosts()
    if err != nil {
        panic(err)
    }
    
    fmt.Println(posts)
}
```

è¿™ç§ä½¿ç”¨æ¥å£ç»„ç»‡ä»£ç çš„æ–¹å¼åœ¨ Go è¯­è¨€ä¸­éå¸¸å¸¸è§ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ä»£ç ä¸­å°½å¯èƒ½åœ°ä½¿ç”¨è¿™ç§æ€æƒ³å’Œæ¨¡å¼å¯¹å¤–æä¾›åŠŸèƒ½ï¼š

- ä½¿ç”¨å¤§å†™çš„ `Service` å¯¹å¤–æš´éœ²æ–¹æ³•ï¼›
- ä½¿ç”¨å°å†™çš„ `service` å®ç°æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼›
- é€šè¿‡ `NewService` å‡½æ•°åˆå§‹åŒ– `Service` æ¥å£ï¼›

å½“æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°æ–¹æ³•ç»„ç»‡ä»£ç ä¹‹åï¼Œå…¶å®å°±å¯¹ä¸åŒæ¨¡å—çš„ä¾èµ–è¿›è¡Œäº†è§£è€¦ï¼Œä¹Ÿæ­£éµå¾ªäº†è½¯ä»¶è®¾è®¡ä¸­ç»å¸¸è¢«æåˆ°çš„ä¸€å¥è¯ â€” ã€`ä¾èµ–æ¥å£ï¼Œä¸è¦ä¾èµ–å®ç°`ã€ï¼Œä¹Ÿå°±æ˜¯é¢å‘æ¥å£ç¼–ç¨‹ã€‚

### å°ç»“
åœ¨è¿™ä¸€å°èŠ‚ä¸­æ€»å…±ä»‹ç»äº† Go è¯­è¨€ä¸­ä¸‰ä¸ªç»å¸¸ä¼šæ‰“äº¤é“çš„ã€å…ƒç´ ã€â€” init å‡½æ•°ã€error å’Œæ¥å£ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¸»è¦æ˜¯æƒ³é€šè¿‡ä¸‰ä¸ªä¸åŒçš„ä¾‹å­ä¸ºå¤§å®¶ä¼ è¾¾çš„ä¸€ä¸ªä¸»è¦æ€æƒ³å°±æ˜¯å°½é‡ä½¿ç”¨æ˜¾å¼çš„ï¼ˆ`explicit`ï¼‰çš„æ–¹å¼ç¼–å†™ Go è¯­è¨€ä»£ç ã€‚

# å•å…ƒæµ‹è¯•

ä¸€ä¸ªä»£ç è´¨é‡å’Œå·¥ç¨‹è´¨é‡æœ‰ä¿è¯çš„é¡¹ç›®ä¸€å®šæœ‰æ¯”è¾ƒåˆç†çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼Œæ²¡æœ‰å•å…ƒæµ‹è¯•çš„é¡¹ç›®ä¸€å®šæ˜¯ä¸åˆæ ¼çš„æˆ–è€…ä¸é‡è¦çš„ï¼Œå•å…ƒæµ‹è¯•åº”è¯¥æ˜¯æ‰€æœ‰é¡¹ç›®éƒ½å¿…é¡»æœ‰çš„ä»£ç ï¼Œæ¯ä¸€ä¸ªå•å…ƒæµ‹è¯•éƒ½è¡¨ç¤ºä¸€ä¸ªå¯èƒ½å‘ç”Ÿçš„æƒ…å†µï¼Œ`å•å…ƒæµ‹è¯•å°±æ˜¯ä¸šåŠ¡é€»è¾‘`ã€‚

ä½œä¸ºè½¯ä»¶å·¥ç¨‹å¸ˆï¼Œé‡æ„ç°æœ‰çš„é¡¹ç›®å¯¹äºæˆ‘ä»¬æ¥è¯´åº”è¯¥æ˜¯ä¸€ä»¶æ¯”è¾ƒæ­£å¸¸çš„äº‹æƒ…ï¼Œå¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰å•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬å¾ˆéš¾åœ¨ä¸æ”¹å˜å·²æœ‰ä¸šåŠ¡é€»è¾‘çš„æƒ…å†µå¯¹é¡¹ç›®è¿›è¡Œé‡æ„ï¼Œä¸€äº›ä¸šåŠ¡çš„è¾¹ç•Œæƒ…å†µå¾ˆå¯èƒ½ä¼šåœ¨é‡æ„çš„è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼Œå½“æ—¶å‚ä¸ç›¸åº” case å¼€å‘çš„å·¥ç¨‹å¸ˆå¯èƒ½å·²ç»ä¸åœ¨å›¢é˜Ÿä¸­ï¼Œè€Œé¡¹ç›®ç›¸å…³çš„æ–‡æ¡£å¯èƒ½ä¹Ÿæ¶ˆå¤±åœ¨äº†å½’æ¡£çš„ wiki ä¸­ï¼ˆæ›´å¤šçš„é¡¹ç›®å¯èƒ½å®Œå…¨æ²¡æœ‰æ–‡æ¡£ï¼‰ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨é‡æ„ä¸­ç›¸ä¿¡çš„ä¸œè¥¿å…¶å®åªæœ‰å½“å‰çš„ä»£ç é€»è¾‘ï¼ˆå¾ˆå¯èƒ½æ˜¯é”™è¯¯çš„ï¼‰ä»¥åŠå•å…ƒæµ‹è¯•ï¼ˆå¾ˆå¯èƒ½æ˜¯æ²¡æœ‰çš„ï¼‰ã€‚

ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œå•å…ƒæµ‹è¯•çš„ç¼ºå¤±ä¸ä»…ä¼šæ„å‘³ç€è¾ƒä½çš„å·¥ç¨‹è´¨é‡ï¼Œè€Œä¸”æ„å‘³ç€é‡æ„çš„éš¾ä»¥è¿›è¡Œï¼Œä¸€ä¸ªæœ‰å•å…ƒæµ‹è¯•çš„é¡¹ç›®å°šä¸”ä¸èƒ½å¤Ÿä¿è¯é‡æ„å‰åçš„é€»è¾‘å®Œå…¨ç›¸åŒï¼Œä¸€ä¸ªæ²¡æœ‰å•å…ƒæµ‹è¯•çš„é¡¹ç›®å¾ˆå¯èƒ½æœ¬èº«çš„é¡¹ç›®è´¨é‡å°±å ªå¿§ï¼Œæ›´ä¸ç”¨è¯´`å¦‚ä½•åœ¨ä¸ä¸¢å¤±ä¸šåŠ¡é€»è¾‘çš„æƒ…å†µä¸‹è¿›è¡Œé‡æ„`äº†ã€‚

## å¯æµ‹è¯•

å†™ä»£ç å¹¶ä¸æ˜¯ä¸€ä»¶å¤šå›°éš¾çš„äº‹æƒ…ï¼Œä¸è¿‡æƒ³è¦åœ¨é¡¹ç›®ä¸­å†™å‡ºå¯ä»¥æµ‹è¯•çš„ä»£ç å¹¶ä¸å®¹æ˜“ï¼Œè€Œä¼˜é›…çš„ä»£ç ä¸€å®šæ˜¯å¯ä»¥æµ‹è¯•çš„ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸€èŠ‚ä¸­éœ€è¦è®¨è®ºçš„å°±æ˜¯ä»€ä¹ˆæ ·çš„ä»£ç æ˜¯å¯ä»¥æµ‹è¯•çš„ã€‚

å¦‚æœæƒ³è¦æƒ³æ¸…æ¥šä»€ä¹ˆæ ·çš„æ‰æ˜¯å¯æµ‹è¯•çš„ï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“æµ‹è¯•æ˜¯ä»€ä¹ˆï¼Ÿä½œè€…å¯¹äºæµ‹è¯•çš„ç†è§£å°±æ˜¯æ§åˆ¶å˜é‡ï¼Œåœ¨æˆ‘ä»¬éš”ç¦»äº†å¾…æµ‹è¯•æ–¹æ³•ä¸­ä¸€äº›ä¾èµ–ä¹‹åï¼Œå½“å‡½æ•°çš„å…¥å‚ç¡®å®šæ—¶ï¼Œå°±åº”è¯¥å¾—åˆ°æœŸæœ›çš„è¿”å›å€¼ã€‚

![golang-unit-test](https://img.draveness.me/golang-unit-test.png)

å¦‚ä½•æ§åˆ¶å¾…æµ‹è¯•æ–¹æ³•ä¸­ä¾èµ–çš„æ¨¡å—æ˜¯å†™å•å…ƒæµ‹è¯•æ—¶è‡³å…³é‡è¦çš„ï¼Œæ§åˆ¶ä¾èµ–ä¹Ÿå°±æ˜¯å¯¹ç›®æ ‡å‡½æ•°çš„ä¾èµ–è¿›è¡Œ `Mock` æ¶ˆç­ä¸ç¡®å®šæ€§ï¼Œä¸ºäº†å‡å°‘æ¯ä¸€ä¸ªå•å…ƒæµ‹è¯•çš„å¤æ‚åº¦ï¼Œæˆ‘ä»¬éœ€è¦ï¼š

- å°½å¯èƒ½å‡å°‘ç›®æ ‡æ–¹æ³•çš„ä¾èµ–ï¼Œè®©ç›®æ ‡æ–¹æ³•åªä¾èµ–å¿…è¦çš„æ¨¡å—ï¼›
- ä¾èµ–çš„æ¨¡å—ä¹Ÿåº”è¯¥éå¸¸å®¹æ˜“åœ°è¿›è¡Œ `Mock` ï¼›

å•å…ƒæµ‹è¯•çš„æ‰§è¡Œä¸åº”è¯¥ä¾èµ–äºä»»ä½•çš„å¤–éƒ¨æ¨¡å—ï¼Œæ— è®ºæ˜¯è°ƒç”¨å¤–éƒ¨çš„ HTTP è¯·æ±‚è¿˜æ˜¯æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥æƒ³å°½åŠæ³•æ¨¡æ‹Ÿå¯èƒ½å‡ºç°çš„æƒ…å†µï¼Œå› ä¸ºå•å…ƒæµ‹è¯•ä¸æ˜¯é›†æˆæµ‹è¯•çš„ï¼Œå®ƒçš„è¿è¡Œä¸åº”è¯¥ä¾èµ–é™¤é¡¹ç›®ä»£ç å¤–çš„å…¶ä»–ä»»ä½•ç³»ç»Ÿã€‚

### æ¥å£

åœ¨ Go è¯­è¨€ä¸­å¦‚æœæˆ‘ä»¬å®Œå…¨ä¸ä½¿ç”¨æ¥å£ï¼Œæ˜¯å†™ä¸å‡ºæ˜“äºæµ‹è¯•çš„ä»£ç çš„ï¼Œä½œä¸ºé™æ€è¯­è¨€çš„ Golangï¼Œåªæœ‰æˆ‘ä»¬ä½¿ç”¨æ¥å£æ‰èƒ½è„±ç¦»ä¾èµ–å…·ä½“å®ç°çš„çª˜å¢ƒï¼Œæ¥å£çš„ä½¿ç”¨èƒ½å¤Ÿä¸ºæˆ‘ä»¬å¸¦æ¥æ›´æ¸…æ™°çš„æŠ½è±¡ï¼Œå¸®åŠ©æˆ‘ä»¬æ€è€ƒå¦‚ä½•å¯¹ä»£ç è¿›è¡Œè®¾è®¡ï¼Œä¹Ÿèƒ½è®©æˆ‘ä»¬æ›´æ–¹ä¾¿åœ°å¯¹ä¾èµ–è¿›è¡Œ `Mock` ã€‚

æˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹ä¸Šä¸€èŠ‚å¯¹æ¥å£è¿›è¡Œä»‹ç»æ—¶å±•ç¤ºçš„å¸¸è§æ¨¡å¼ï¼š

```go
type Service interface { ... }

type service struct { ... }

func NewService(...) (Service, error) {
    return &service{...}, nil
}
```

ä¸Šè¿°ä»£ç åœ¨ Go è¯­è¨€ä¸­æ˜¯éå¸¸å¸¸è§çš„ï¼Œå¦‚æœä½ ä¸çŸ¥é“åº”ä¸åº”è¯¥ä½¿ç”¨æ¥å£å¯¹å¤–æä¾›æœåŠ¡ï¼Œè¿™æ—¶å°±åº”è¯¥æ— è„‘åœ°ä½¿ç”¨ä¸Šè¿°æ¨¡å¼å¯¹å¤–æš´éœ²æ–¹æ³•äº†ï¼Œè¿™ç§æ¨¡å¼å¯ä»¥åœ¨ç»å¤§å¤šæ•°çš„åœºæ™¯ä¸‹å·¥ä½œï¼Œè‡³å°‘ä½œè€…åˆ°ç›®å‰è¿˜æ²¡æœ‰è§åˆ°è¿‡ä¸é€‚ç”¨çš„ã€‚

### å‡½æ•°ç®€å•

å¦ä¸€ä¸ªå»ºè®®å°±æ˜¯ä¿è¯æ¯ä¸€ä¸ªå‡½æ•°å°½å¯èƒ½ç®€å•ï¼Œè¿™é‡Œçš„ç®€å•ä¸æ­¢æ˜¯æŒ‡åŠŸèƒ½ä¸Šçš„ç®€å•ã€å•ä¸€ï¼Œè¿˜æ„å‘³ç€å‡½æ•°å®¹æ˜“ç†è§£å¹¶ä¸”å‘½åèƒ½å¤Ÿè‡ªè§£é‡Šã€‚

ä¸€äº›è¯­è¨€çš„ `lint` å·¥å…·å…¶å®ä¼šå¯¹å‡½æ•°çš„ç†è§£å¤æ‚åº¦ï¼ˆ `PerceivedComplexity` ï¼‰è¿›è¡Œæ£€æŸ¥ï¼Œä¹Ÿå°±æ˜¯æ£€æŸ¥å‡½æ•°ä¸­å‡ºç°çš„ `if/elseã€switch/case` åˆ†æ”¯ä»¥åŠæ–¹æ³•çš„è°ƒç”¨çš„æ•°é‡ï¼Œä¸€æ—¦è¶…è¿‡çº¦å®šçš„é˜ˆå€¼å°±ä¼šæŠ¥é”™ï¼ŒRuby ç¤¾åŒºä¸­çš„ Rubocop å’Œä¸Šé¢æåˆ°çš„ `golangci-lint` éƒ½æœ‰è¿™ä¸ªåŠŸèƒ½ã€‚

Ruby ç¤¾åŒºä¸­çš„ Rubocop å¯¹äºå‡½æ•°çš„é•¿åº¦å’Œç†è§£å¤æ‚åº¦éƒ½æœ‰ç€éå¸¸ä¸¥æ ¼çš„é™åˆ¶ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹å‡½æ•°çš„è¡Œæ•°ä¸èƒ½è¶…è¿‡ 10 è¡Œï¼Œç†è§£å¤æ‚åº¦ä¹Ÿä¸èƒ½è¶…è¿‡ 7ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒRubocop å…¶å®è¿˜æœ‰å…¶ä»–çš„å¤æ‚åº¦é™åˆ¶ï¼Œä¾‹å¦‚å¾ªç¯å¤æ‚åº¦ï¼ˆ `CyclomaticComplexity` ï¼‰ï¼Œè¿™äº›å¤æ‚åº¦çš„é™åˆ¶éƒ½æ˜¯ä¸ºäº†ä¿è¯å‡½æ•°çš„ç®€å•å’Œå®¹æ˜“ç†è§£ã€‚

## ç»„ç»‡æ–¹å¼
å¦‚ä½•å¯¹æµ‹è¯•è¿›è¡Œç»„ç»‡ä¹Ÿæ˜¯ä¸€ä¸ªå€¼å¾—è®¨è®ºçš„è¯é¢˜ï¼ŒGolang ä¸­çš„å•å…ƒæµ‹è¯•æ–‡ä»¶å’Œä»£ç éƒ½æ˜¯ä¸æºä»£ç æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹æŒ‰ç…§ `package` è¿›è¡Œç»„ç»‡çš„ï¼Œ`server.go` æ–‡ä»¶å¯¹åº”çš„æµ‹è¯•ä»£ç åº”è¯¥æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹çš„ `server_test.go` æ–‡ä»¶ä¸­ã€‚

å¦‚æœæ–‡ä»¶ä¸æ˜¯ä»¥ `_test.go` ç»“å°¾ï¼Œå½“æˆ‘ä»¬è¿è¡Œ `go test ./pkg` æ—¶å°±ä¸ä¼šæ‰¾åˆ°è¯¥æ–‡ä»¶ä¸­çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå…¶ä¸­çš„ä»£ç ä¹Ÿå°±ä¸ä¼šè¢«æ‰§è¡Œï¼Œè¿™ä¹Ÿæ˜¯ Go è¯­è¨€å¯¹äºæµ‹è¯•ç»„ç»‡æ–¹æ³•çš„ä¸€ä¸ªçº¦å®šã€‚

### Test
å•å…ƒæµ‹è¯•çš„æœ€å¸¸è§ä»¥åŠé»˜è®¤ç»„ç»‡æ–¹å¼å°±æ˜¯å†™åœ¨ä»¥ `_test.go` ç»“å°¾çš„æ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰çš„æµ‹è¯•æ–¹æ³•ä¹Ÿéƒ½æ˜¯ä»¥ `Test` å¼€å¤´å¹¶ä¸”åªæ¥å—ä¸€ä¸ª `testing.T` ç±»å‹çš„å‚æ•°ï¼š

```go
func TestAuthor(t *testing.T) {
    author := blog.Author()
    assert.Equal(t, "draveness", author)
}
```

å¦‚æœæˆ‘ä»¬è¦ç»™å‡½æ•°åä¸º `Add` çš„æ–¹æ³•å†™å•å…ƒæµ‹è¯•ï¼Œé‚£ä¹ˆå¯¹åº”çš„æµ‹è¯•æ–¹æ³•ä¸€èˆ¬ä¼šè¢«å†™æˆ `TestAdd` ï¼Œä¸ºäº†åŒæ—¶æµ‹è¯•å¤šä¸ªåˆ†æ”¯çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„æ–¹å¼ç»„ç»‡ `Add` å‡½æ•°ç›¸å…³çš„æµ‹è¯•ï¼š

```go
func TestAdd(t *testing.T) {
    assert.Equal(t, 5, Add(2, 3))
}

func TestAddWithNegativeNumber(t *testing.T) {
    assert.Equal(t, -2, Add(-1, -1))
}
```

é™¤äº†è¿™ç§å°†ä¸€ä¸ªå‡½æ•°ç›¸å…³çš„æµ‹è¯•åˆ†æ•£åˆ°å¤šä¸ª `Test` æ–¹æ³•ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `for` å¾ªç¯æ¥å‡å°‘é‡å¤çš„æµ‹è¯•ä»£ç ï¼Œè¿™åœ¨é€»è¾‘æ¯”è¾ƒå¤æ‚çš„æµ‹è¯•ä¸­ä¼šéå¸¸å¥½ç”¨ï¼Œèƒ½å¤Ÿå‡å°‘å¤§é‡çš„é‡å¤ä»£ç ï¼Œä¸è¿‡ä¹Ÿéœ€è¦æˆ‘ä»¬å°å¿ƒåœ°è¿›è¡Œè®¾è®¡ï¼š

```go
func TestAdd(t *testing.T) {
    tests := []struct{
        name     string
        first    int64
        second   int64
        expected int64
    } {
        {
            name:     "HappyPath":
            first:    2,
            second:   3,
            expected: 5,
        },
        {
            name:     "NegativeNumber":
            first:    -1,
            second:   -1,
            expected: -2,
        },
    }
    
    for _, test := range tests {
        t.Run(test.name, func(t *testing.T) {
            assert.Equal(t, test.expected, Add(test.first, test.second))
        })
    }
}
```

è¿™ç§æ–¹å¼å…¶å®ä¹Ÿèƒ½ç”Ÿæˆæ ‘å½¢çš„æµ‹è¯•ç»“æœï¼Œå°† `Add` ç›¸å…³çš„æµ‹è¯•åˆ†æˆä¸€ç»„æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œè§‚å¯Ÿå’Œç†è§£ï¼Œä¸è¿‡è¿™ç§æµ‹è¯•ç»„ç»‡æ–¹æ³•éœ€è¦æˆ‘ä»¬ä¿è¯æµ‹è¯•ä»£ç çš„é€šç”¨æ€§ï¼Œå½“å‡½æ•°ä¾èµ–çš„ä¸Šä¸‹æ–‡è¾ƒå¤šæ—¶å¾€å¾€éœ€è¦æˆ‘ä»¬å†™å¾ˆå¤šçš„ `if/else` æ¡ä»¶åˆ¤æ–­è¯­å¥å½±å“æˆ‘ä»¬å¯¹æµ‹è¯•çš„å¿«é€Ÿç†è§£ã€‚

ä½œè€…é€šå¸¸ä¼šåœ¨æµ‹è¯•ä»£ç æ¯”è¾ƒç®€å•æ—¶ä½¿ç”¨ç¬¬ä¸€ç§ç»„ç»‡æ–¹å¼ï¼Œè€Œåœ¨ä¾èµ–è¾ƒå¤šã€å‡½æ•°åŠŸèƒ½è¾ƒä¸ºå¤æ‚æ—¶ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œä¸è¿‡è¿™ä¹Ÿä¸æ˜¯å®šè®ºï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å®é™…æƒ…å†µå†³å®šå¦‚ä½•å¯¹æµ‹è¯•è¿›è¡Œè®¾è®¡ã€‚

### Suite

ç¬¬äºŒç§æ¯”è¾ƒå¸¸è§çš„æ–¹å¼æ˜¯æŒ‰ç…§ç°‡è¿›è¡Œç»„ç»‡ï¼Œå…¶å®å°±æ˜¯å¯¹ Go è¯­è¨€é»˜è®¤çš„æµ‹è¯•æ–¹å¼è¿›è¡Œç®€å•çš„å°è£…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `stretchr/testify` ä¸­çš„ `suite` åŒ…å¯¹æµ‹è¯•è¿›è¡Œç»„ç»‡ï¼š

```go
import (
    "testing"
    "github.com/stretchr/testify/suite"
)

type ExampleTestSuite struct {
    suite.Suite
    VariableThatShouldStartAtFive int
}

func (suite *ExampleTestSuite) SetupTest() {
    suite.VariableThatShouldStartAtFive = 5
}

func (suite *ExampleTestSuite) TestExample() {
    suite.Equal(suite.VariableThatShouldStartAtFive, 5)
}

func TestExampleTestSuite(t *testing.T) {
    suite.Run(t, new(ExampleTestSuite))
}
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `suite` åŒ…ï¼Œä»¥ç»“æ„ä½“çš„æ–¹å¼å¯¹æµ‹è¯•ç°‡è¿›è¡Œç»„ç»‡ï¼Œ `suite` æä¾›çš„ `SetupTest/SetupSuite` å’Œ `TearDownTest/TearDownSuite` æ˜¯æ‰§è¡Œæµ‹è¯•å‰åä»¥åŠæ‰§è¡Œæµ‹è¯•ç°‡å‰åçš„é’©å­æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½åœ¨å…¶ä¸­å®Œæˆä¸€äº›å…±äº«èµ„æºçš„åˆå§‹åŒ–ï¼Œå‡å°‘æµ‹è¯•ä¸­çš„åˆå§‹åŒ–ä»£ç ã€‚

### BDD

æœ€åä¸€ç§ç»„ç»‡ä»£ç çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨ `BDD` çš„é£æ ¼å¯¹å•å…ƒæµ‹è¯•è¿›è¡Œç»„ç»‡ï¼Œginkgo å°±æ˜¯ Golang ç¤¾åŒºæœ€å¸¸è§çš„ `BDD` æ¡†æ¶äº†ï¼Œè¿™é‡Œæåˆ°çš„è¡Œä¸ºé©±åŠ¨å¼€å‘ï¼ˆ`BDD`ï¼‰å’Œæµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆ`TDD`ï¼‰éƒ½æ˜¯ä¸€ç§ä¿è¯å·¥ç¨‹è´¨é‡çš„æ–¹æ³•è®ºã€‚æƒ³è¦åœ¨é¡¹ç›®ä¸­å®è·µè¿™ç§æ€æƒ³è¿˜æ˜¯éœ€è¦ä¸€äº›æ€ç»´ä¸Šçš„è½¬å˜å’Œé€‚åº”ï¼Œä¹Ÿå°±æ˜¯å…ˆé€šè¿‡å†™å•å…ƒæµ‹è¯•æˆ–è€…è¡Œä¸ºæµ‹è¯•çº¦å®šæ–¹æ³•çš„ `Spec`ï¼Œå†å®ç°æ–¹æ³•è®©æˆ‘ä»¬çš„æµ‹è¯•é€šè¿‡ï¼Œè¿™æ˜¯ä¸€ç§æ¯”è¾ƒç§‘å­¦çš„æ–¹æ³•ï¼Œå®ƒèƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥æ¯”è¾ƒå¼ºçš„ä¿¡å¿ƒã€‚

æˆ‘ä»¬è™½ç„¶ä¸ä¸€å®šè¦ä½¿ç”¨ `BDD/TDD` çš„æ€æƒ³å¯¹é¡¹ç›®è¿›è¡Œå¼€å‘ï¼Œä½†æ˜¯å´å¯ä»¥ä½¿ç”¨ BDD çš„é£æ ¼æ–¹å¼ç»„ç»‡éå¸¸æ˜“è¯»çš„æµ‹è¯•ä»£ç ï¼š


```go
var _ = Describe("Book", func() {
    var (
        book Book
        err error
    )

    BeforeEach(func() {
        book, err = NewBookFromJSON(`{
            "title":"Les Miserables",
            "author":"Victor Hugo",
            "pages":1488
        }`)
    })

    Describe("loading from JSON", func() {
        Context("when the JSON fails to parse", func() {
            BeforeEach(func() {
                book, err = NewBookFromJSON(`{
                    "title":"Les Miserables",
                    "author":"Victor Hugo",
                    "pages":1488oops
                }`)
            })

            It("should return the zero-value for the book", func() {
                Expect(book).To(BeZero())
            })

            It("should error", func() {
                Expect(err).To(HaveOccurred())
            })
        })
    })
})
```

`BDD` æ¡†æ¶ä¸­ä¸€èˆ¬éƒ½åŒ…å« `Describeã€Context` ä»¥åŠ `It` ç­‰ä»£ç å—ï¼Œå…¶ä¸­ `Describe` çš„ä½œç”¨æ˜¯æè¿°ä»£ç çš„ç‹¬ç«‹è¡Œä¸ºã€`Context` æ˜¯åœ¨ä¸€ä¸ªç‹¬ç«‹è¡Œä¸ºä¸­çš„å¤šä¸ªä¸åŒä¸Šä¸‹æ–‡ï¼Œæœ€åçš„ `It` ç”¨äºæè¿°æœŸæœ›çš„è¡Œä¸ºï¼Œè¿™äº›ä»£ç å—æœ€ç»ˆéƒ½æ„æˆäº†ç±»ä¼¼ã€`æè¿°â€¦â€¦ï¼Œå½“â€¦â€¦æ—¶ï¼Œå®ƒåº”è¯¥â€¦â€¦`ã€çš„å¥å¼å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåœ°ç†è§£æµ‹è¯•ä»£ç ã€‚

## Mock æ–¹æ³•

é¡¹ç›®ä¸­çš„å•å…ƒæµ‹è¯•åº”è¯¥æ˜¯ç¨³å®šçš„å¹¶ä¸”ä¸ä¾èµ–ä»»ä½•çš„å¤–éƒ¨é¡¹ç›®ï¼Œå®ƒåªæ˜¯å¯¹é¡¹ç›®ä¸­å‡½æ•°å’Œæ–¹æ³•çš„æµ‹è¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨å•å…ƒæµ‹è¯•ä¸­å¯¹æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹çš„ä¸ç¨³å®šä¾èµ–è¿›è¡Œ `Mock` ï¼Œä¹Ÿå°±æ˜¯æ¨¡æ‹Ÿè¿™äº›ç¬¬ä¸‰æ–¹æœåŠ¡çš„æ¥å£ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œä¸ºäº†ç®€åŒ–ä¸€æ¬¡å•å…ƒæµ‹è¯•çš„ä¸Šä¸‹æ–‡ï¼Œåœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­æˆ‘ä»¬ä¹Ÿä¼šå¯¹å…¶ä»–æ¨¡å—è¿›è¡Œ Mockï¼Œæ¨¡æ‹Ÿè¿™äº›ä¾èµ–æ¨¡å—çš„è¿”å›å€¼ã€‚

å•å…ƒæµ‹è¯•çš„æ ¸å¿ƒå°±æ˜¯éš”ç¦»ä¾èµ–å¹¶éªŒè¯è¾“å…¥å’Œè¾“å‡ºçš„æ­£ç¡®æ€§ï¼ŒGo è¯­è¨€ä½œä¸ºä¸€ä¸ªé™æ€è¯­è¨€æä¾›äº†æ¯”è¾ƒå°‘çš„è¿è¡Œæ—¶ç‰¹æ€§ï¼Œè¿™ä¹Ÿè®©æˆ‘ä»¬åœ¨ Go è¯­è¨€ä¸­ `Mock` ä¾èµ–å˜å¾—éå¸¸å›°éš¾ã€‚

`Mock` çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¿è¯å¾…æµ‹è¯•æ–¹æ³•ä¾èµ–çš„ä¸Šä¸‹æ–‡å›ºå®šï¼Œåœ¨è¿™æ—¶æ— è®ºæˆ‘ä»¬å¯¹å½“å‰æ–¹æ³•è¿è¡Œå¤šå°‘æ¬¡å•å…ƒæµ‹è¯•ï¼Œå¦‚æœä¸šåŠ¡é€»è¾‘ä¸æ”¹å˜ï¼Œå®ƒéƒ½åº”è¯¥è¿”å›å®Œå…¨ç›¸åŒçš„ç»“æœï¼Œåœ¨å…·ä½“ä»‹ç» `Mock` çš„ä¸åŒæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ¸…æ¥šä¸€äº›å¸¸è§çš„ä¾èµ–ï¼Œä¸€ä¸ªå‡½æ•°æˆ–è€…æ–¹æ³•çš„å¸¸è§ä¾èµ–å¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§ï¼š

- æ¥å£
- æ•°æ®åº“
- HTTP è¯·æ±‚
- Redisã€ç¼“å­˜ä»¥åŠå…¶ä»–ä¾èµ–

è¿™äº›ä¸åŒçš„åœºæ™¯åŸºæœ¬æ¶µç›–äº†å†™å•å…ƒæµ‹è¯•æ—¶ä¼šé‡åˆ°çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥çš„å†…å®¹ä¸­åˆ†åˆ«ä»‹ç»å¦‚ä½•å¤„ç†ä»¥ä¸Šå‡ ç§ä¸åŒçš„ä¾èµ–ã€‚

### æ¥å£

é¦–å…ˆè¦ä»‹ç»çš„å…¶å®å°±æ˜¯ Go è¯­è¨€ä¸­æœ€å¸¸è§ä¹Ÿæ˜¯æœ€é€šç”¨çš„ `Mock` æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯èƒ½å¤Ÿå¯¹æ¥å£è¿›è¡Œ `Mock` çš„ `golang/mock` æ¡†æ¶ï¼Œå®ƒèƒ½å¤Ÿæ ¹æ®æ¥å£ç”Ÿæˆ `Mock` å®ç°ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹ä»£ç ï¼š

```go
package blog

type Post struct {}

type Blog interface {
	ListPosts() []Post
}

type jekyll struct {}

func (b *jekyll) ListPosts() []Post {
 	return []Post{}
}

type wordpress struct{}

func (b *wordpress) ListPosts() []Post {
	return []Post{}
}
```

æˆ‘ä»¬çš„åšå®¢å¯èƒ½ä½¿ç”¨ `jekyll` æˆ–è€… `wordpress` ä½œä¸ºå¼•æ“ï¼Œä½†æ˜¯å®ƒä»¬éƒ½ä¼šæä¾› `ListsPosts` æ–¹æ³•ç”¨äºè¿”å›å…¨éƒ¨çš„æ–‡ç« åˆ—è¡¨ï¼Œåœ¨è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦å®šä¹‰ä¸€ä¸ª `Post` æ¥å£ï¼Œæ¥å£è¦æ±‚éµå¾ª `Blog` çš„ç»“æ„ä½“å¿…é¡»å®ç° `ListPosts` æ–¹æ³•ã€‚

![golang-interface-blog-example](https://img.draveness.me/golang-interface-blog-example.png)

å½“æˆ‘ä»¬å®šä¹‰å¥½äº† `Blog` æ¥å£ä¹‹åï¼Œä¸Šå±‚ `Service` å°±ä¸å†éœ€è¦ä¾èµ–æŸä¸ªå…·ä½“çš„åšå®¢å¼•æ“å®ç°äº†ï¼Œåªéœ€è¦ä¾èµ– `Blog` æ¥å£å°±å¯ä»¥å®Œæˆå¯¹æ–‡ç« çš„æ‰¹é‡è·å–åŠŸèƒ½ï¼š

```go
package service

type Service interface {
	ListPosts() ([]Post, error)
}

type service struct {
    blog blog.Blog
}

func NewService(b blog.Blog) *Service {
    return &service{
        blog: b,
    }
}

func (s *service) ListPosts() ([]Post, error) {
    return s.blog.ListPosts(), nil
}
```

å¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹ `Service` è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ `gomock` æä¾›çš„ `mockgen` å·¥å…·å‘½ä»¤ç”Ÿæˆ `MockBlog` ç»“æ„ä½“ï¼Œä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„å‘½ä»¤ï¼š

```sh
$ mockgen -package=mblog -source=pkg/blog/blog.go > test/mocks/blog/blog.go

$ cat test/mocks/blog/blog.go
// Code generated by MockGen. DO NOT EDIT.
// Source: blog.go

// Package mblog is a generated GoMock package.
...
// NewMockBlog creates a new mock instance
func NewMockBlog(ctrl *gomock.Controller) *MockBlog {
	mock := &MockBlog{ctrl: ctrl}
	mock.recorder = &MockBlogMockRecorder{mock}
	return mock
}

// EXPECT returns an object that allows the caller to indicate expected use
func (m *MockBlog) EXPECT() *MockBlogMockRecorder {
	return m.recorder
}

// ListPosts mocks base method
func (m *MockBlog) ListPosts() []Post {
	m.ctrl.T.Helper()
	ret := m.ctrl.Call(m, "ListPosts")
	ret0, _ := ret[0].([]Post)
	return ret0
}

// ListPosts indicates an expected call of ListPosts
func (mr *MockBlogMockRecorder) ListPosts() *gomock.Call {
	mr.mock.ctrl.T.Helper()
	return mr.mock.ctrl.RecordCallWithMethodType(mr.mock, "ListPosts", reflect.TypeOf((*MockBlog)(nil).ListPosts))
}
```

è¿™æ®µ `mockgen` ç”Ÿæˆçš„ä»£ç éå¸¸é•¿çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªå±•ç¤ºäº†å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒçš„åŠŸèƒ½å°±æ˜¯å¸®åŠ©æˆ‘ä»¬éªŒè¯ä»»æ„æ¥å£çš„è¾“å…¥å‚æ•°å¹¶ä¸”æ¨¡æ‹Ÿæ¥å£çš„è¿”å›å€¼ï¼›è€Œåœ¨ç”Ÿæˆ `Mock` å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œä½œè€…æ€»ç»“äº†ä¸€äº›å¯ä»¥åˆ†äº«çš„ç»éªŒï¼š

åœ¨ `test/mocks` ç›®å½•ä¸­æ”¾ç½®æ‰€æœ‰çš„ `Mock` å®ç°ï¼Œå­ç›®å½•ä¸æ¥å£æ‰€åœ¨æ–‡ä»¶çš„äºŒçº§ç›®å½•ç›¸åŒï¼Œåœ¨è¿™é‡Œæºæ–‡ä»¶çš„ä½ç½®åœ¨ `pkg/blog/blog.go`ï¼Œå®ƒçš„äºŒçº§ç›®å½•å°±æ˜¯ `blog/`ï¼Œæ‰€ä»¥å¯¹åº”çš„ `Mock` å®ç°ä¼šè¢«ç”Ÿæˆåˆ° `test/mocks/blog/` ç›®å½•ä¸­ï¼›

æŒ‡å®š `package` ä¸º `mxxx`ï¼Œé»˜è®¤çš„ `mock_xxx` çœ‹èµ·æ¥éå¸¸å†—ä½™ï¼Œä¸Šè¿° `blog` åŒ…å¯¹åº”çš„ `Mock` åŒ…ä¹Ÿå°±æ˜¯ `mblog` ï¼›

`mockgen` å‘½ä»¤æ”¾ç½®åˆ° `Makefile` ä¸­çš„ `mock` ä¸‹ç»Ÿä¸€ç®¡ç†ï¼Œå‡å°‘ç¥–ä¼ å‘½ä»¤çš„å‡ºç°ï¼›

```
 mockï¼š
     rm -rf test/mocks
        
     mkdir -p test/mocks/blog
     mockgen -package=mblog -source=pkg/blog/blog.go > test/mocks/blog/blog.go
```

å½“æˆ‘ä»¬ç”Ÿæˆäº†ä¸Šè¿°çš„ `Mock` å®ç°ä»£ç ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼ä¸º `Service` å†™å•å…ƒæµ‹è¯•äº†ï¼Œè¿™æ®µä»£ç é€šè¿‡ `NewMockBlog` ç”Ÿæˆä¸€ä¸ª `Blog` æ¥å£çš„ `Mock` å®ç°ï¼Œç„¶åé€šè¿‡ `EXPECT` æ–¹æ³•æ§åˆ¶è¯¥å®ç°ä¼šåœ¨è°ƒç”¨ `ListPosts` æ—¶è¿”å›ç©ºçš„ `Post` æ•°ç»„ï¼š

```go
func TestListPosts(t *testing.T) {
	ctrl := gomock.NewController(t)
	defer ctrl.Finish()

 	mockBlog := mblog.NewMockBlog(ctrl)
 	mockBlog.EXPECT().ListPosts().Return([]Post{})
  
 	service := NewService(mockBlog)
  
 	assert.Equal(t, []Post{}, service.ListPosts())
}
```

ç”±äºå½“å‰ `Service` åªä¾èµ–äº `Blog` çš„å®ç°ï¼Œæ‰€ä»¥åœ¨è¿™æ—¶æˆ‘ä»¬å°±èƒ½å¤Ÿæ–­è¨€å½“å‰æ–¹æ³•ä¸€å®šä¼šè¿”å› `[]Post{}`ï¼Œè¿™æ—¶æˆ‘ä»¬çš„æ–¹æ³•çš„è¿”å›å€¼å°±åªä¸ä¼ å…¥çš„å‚æ•°æœ‰å…³ï¼ˆè™½ç„¶ `ListPosts` æ–¹æ³•æ²¡æœ‰å…¥å‚)ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå‡å°‘ä¸€æ¬¡å…³æ³¨çš„ä¸Šä¸‹æ–‡å¹¶ä¿è¯æµ‹è¯•çš„ç¨³å®šå’Œå¯ä¿¡ã€‚

è¿™æ˜¯ Go è¯­è¨€ä¸­æœ€æ ‡å‡†çš„å•å…ƒæµ‹è¯•å†™æ³•ï¼Œæ‰€æœ‰ä¾èµ–çš„ `package` æ— è®ºæ˜¯é¡¹ç›®å†…å¤–éƒ½åº”è¯¥ä½¿ç”¨è¿™ç§æ–¹å¼å¤„ç†ï¼ˆåœ¨æœ‰æ¥å£çš„æƒ…å†µä¸‹ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ¥å£ Go è¯­è¨€çš„å•å…ƒæµ‹è¯•å°±ä¼šéå¸¸éš¾å†™ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»é¡¹ç›®ä¸­æ˜¯å¦æœ‰æ¥å£å°±èƒ½åˆ¤æ–­å·¥ç¨‹è´¨é‡çš„åŸå› äº†ã€‚

### SQL
å¦ä¸€ä¸ªé¡¹ç›®ä¸­æ¯”è¾ƒå¸¸è§çš„ä¾èµ–å…¶å®å°±æ˜¯æ•°æ®åº“ï¼Œåœ¨é‡åˆ°æ•°æ®åº“çš„ä¾èµ–æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ `sqlmock` æ¥æ¨¡æ‹Ÿæ•°æ®åº“çš„è¿æ¥ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ `sqlmock` æ—¶ä¼šå†™å‡ºå¦‚ä¸‹æ‰€ç¤ºçš„å•å…ƒæµ‹è¯•ï¼š

```go
func (s *suiteServerTester) TestRemovePost() {
	entry := pb.Post{
		Id: 1,
	}

	rows := sqlmock.NewRows([]string{"id", "author"}).AddRow(1, "draveness")

	s.Mock.ExpectQuery(`SELECT (.+) FROM "posts"`).WillReturnRows(rows)
	s.Mock.ExpectExec(`DELETE FROM "posts"`).
		WithArgs(1).
		WillReturnResult(sqlmock.NewResult(1, 1))

	response, err := s.server.RemovePost(context.Background(), &entry)

	s.NoError(err)
	s.EqualValues(response, &entry)
	s.NoError(s.Mock.ExpectationsWereMet())
}
```

æœ€å¸¸ç”¨çš„å‡ ä¸ªæ–¹æ³•å°±æ˜¯ `ExpectQuery` å’Œ `ExpectExec` ï¼Œå‰è€…ä¸»è¦ç”¨äºæ¨¡æ‹Ÿ `SQL` çš„æŸ¥è¯¢è¯­å¥ï¼Œåè€…ç”¨äºæ¨¡æ‹Ÿ `SQL` çš„å¢åˆ ï¼Œä»ä¸Šé¢çš„å®ä¾‹ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªè¿™ä¸¤ç§æ–¹æ³•çš„ä½¿ç”¨æ–¹å¼ï¼Œå»ºè®®å„ä½å…ˆé˜…è¯»ç›¸å…³çš„ æ–‡æ¡£ å†å°è¯•ä½¿ç”¨ã€‚

### HTTP

`HTTP` è¯·æ±‚ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ç»å¸¸ä¼šé‡åˆ°çš„ä¾èµ–ï¼Œ [httpmock](https://github.com/jarcoal/httpmock) å°±æ˜¯ä¸€ä¸ªç”¨äº `Mock` æ‰€æœ‰ `HTTP` ä¾èµ–çš„åŒ…ï¼Œå®ƒä½¿ç”¨æ¨¡å¼åŒ¹é…çš„æ–¹å¼åŒ¹é… `HTTP` è¯·æ±‚çš„ `URL` ï¼Œåœ¨åŒ¹é…åˆ°ç‰¹å®šçš„è¯·æ±‚æ—¶å°±ä¼šè¿”å›é¢„å…ˆè®¾ç½®å¥½çš„å“åº”ã€‚

```go
func TestFetchArticles(t *testing.T) {
	httpmock.Activate()
	defer httpmock.DeactivateAndReset()

	httpmock.RegisterResponder("GET", "https://api.mybiz.com/articles",
		httpmock.NewStringResponder(200, `[{"id": 1, "name": "My Great Article"}]`))

	httpmock.RegisterResponder("GET", `=~^https://api\.mybiz\.com/articles/id/\d+\z`,
		httpmock.NewStringResponder(200, `{"id": 1, "name": "My Great Article"}`))

	...
}
```

å¦‚æœé‡åˆ° `HTTP` è¯·æ±‚çš„ä¾èµ–æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸Šè¿° [httpmock](https://github.com/jarcoal/httpmock) åŒ…æ¨¡æ‹Ÿä¾èµ–çš„ `HTTP` è¯·æ±‚ã€‚

### çŒ´å­è¡¥ä¸

æœ€åè¦ä»‹ç»çš„çŒ´å­è¡¥ä¸å…¶å®å°±æ˜¯ä¸€ä¸ªå¤§æ€å™¨äº†ï¼Œ[bouk/monkey](https://github.com/bouk/monkey) èƒ½å¤Ÿé€šè¿‡æ›¿æ¢å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼ä¿®æ”¹ä»»æ„å‡½æ•°çš„å®ç°ï¼Œæ‰€ä»¥å¦‚æœä¸Šè¿°çš„å‡ ç§æ–¹æ³•éƒ½ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å°±åªèƒ½å¤Ÿé€šè¿‡çŒ´å­è¡¥ä¸è¿™ç§æ¯”è¾ƒ `hack` çš„æ–¹æ³• `Mock` ä¾èµ–äº†ï¼š

```go
func main() {
	monkey.Patch(fmt.Println, func(a ...interface{}) (n int, err error) {
		s := make([]interface{}, len(a))
		for i, v := range a {
			s[i] = strings.Replace(fmt.Sprint(v), "hell", "*bleep*", -1)
		}
		return fmt.Fprintln(os.Stdout, s...)
	})
	fmt.Println("what the hell?") // what the *bleep*?
}
```

ç„¶è€Œè¿™ç§æ–¹æ³•çš„ä½¿ç”¨å…¶å®æœ‰ä¸€äº›é™åˆ¶ï¼Œç”±äºå®ƒæ˜¯åœ¨è¿è¡Œæ—¶æ›¿æ¢äº†å‡½æ•°çš„æŒ‡é’ˆï¼Œæ‰€ä»¥å¦‚æœé‡åˆ°ä¸€äº›ç®€å•çš„å‡½æ•°ï¼Œä¾‹å¦‚ `rand.Int63n` å’Œ `time.Now`ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šç›´æ¥å°†è¿™ç§å‡½æ•°å†…è”åˆ°è°ƒç”¨å®é™…å‘ç”Ÿçš„ä»£ç å¤„å¹¶ä¸ä¼šè°ƒç”¨åŸæœ‰çš„æ–¹æ³•ï¼Œæ‰€ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼å¾€å¾€éœ€è¦æˆ‘ä»¬åœ¨æµ‹è¯•æ—¶é¢å¤–æŒ‡å®š `-gcflags=-l` ç¦æ­¢ç¼–è¯‘å™¨çš„å†…è”ä¼˜åŒ–ã€‚

```go
$ go test -gcflags=-l ./...
```

[bouk/monkey](https://github.com/bouk/monkey) çš„ `README` å¯¹äºå®ƒçš„ä½¿ç”¨ç»™å‡ºäº†ä¸€äº›æ³¨æ„äº‹é¡¹ï¼Œé™¤äº†å†…è”ç¼–è¯‘ä¹‹å¤–ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯`ä¸è¦åœ¨å•å…ƒæµ‹è¯•ä¹‹å¤–çš„åœ°æ–¹ä½¿ç”¨çŒ´å­è¡¥ä¸`ï¼Œæˆ‘ä»¬åº”è¯¥åªåœ¨å¿…è¦çš„æ—¶å€™ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œä¾‹å¦‚ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“æ²¡æœ‰æä¾› `interface` æˆ–è€…ä¿®æ”¹ `time.Now` ä»¥åŠ `rand.Int63n` ç­‰å†…ç½®å‡½æ•°çš„è¿”å›å€¼ç”¨äºæµ‹è¯•æ—¶ã€‚

ä»ç†è®ºä¸Šæ¥è¯´ï¼Œé€šè¿‡çŒ´å­è¡¥ä¸è¿™ç§æ–¹å¼æˆ‘ä»¬èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶ Mock Go è¯­è¨€ä¸­çš„ä¸€åˆ‡å‡½æ•°ï¼Œè¿™ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†å•å…ƒæµ‹è¯• Mock ä¾èµ–çš„æœ€ç»ˆè§£å†³æ–¹æ¡ˆã€‚

### æ–­è¨€

åœ¨æœ€åï¼Œæˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹è¾…åŠ©å•å…ƒæµ‹è¯•çš„ [assert](https://github.com/stretchr/testify) åŒ…ï¼Œå®ƒæä¾›äº†éå¸¸å¤šçš„æ–­è¨€æ–¹æ³•å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå¯¹æœŸæœ›çš„è¿”å›å€¼è¿›è¡Œæµ‹è¯•ï¼Œå‡å°‘æˆ‘ä»¬çš„å·¥ä½œé‡ï¼š

```go
func TestSomething(t *testing.T) {
  assert.Equal(t, 123, 123, "they should be equal")

  assert.NotEqual(t, 123, 456, "they should not be equal")

  assert.Nil(t, object)

  if assert.NotNil(t, object) {
    assert.Equal(t, "Something", object.Value)
  }
}
```

åœ¨è¿™é‡Œæˆ‘ä»¬ä¹Ÿæ˜¯ç®€å•å±•ç¤ºä¸€ä¸‹ `assert` çš„ç¤ºä¾‹ï¼Œæ›´è¯¦ç»†çš„å†…å®¹å¯ä»¥é˜…è¯»å®ƒçš„ç›¸å…³æ–‡æ¡£ï¼Œåœ¨è¿™é‡Œä¹Ÿå°±ä¸å¤šåšå±•ç¤ºäº†ã€‚

### å°ç»“

å¦‚æœä¹‹å‰å®Œå…¨æ²¡æœ‰å†™è¿‡å•å…ƒæµ‹è¯•æˆ–è€…æ²¡æœ‰å†™è¿‡ Go è¯­è¨€çš„å•å…ƒæµ‹è¯•ï¼Œç›¸ä¿¡è¿™ç¯‡æ–‡ç« å·²ç»ç»™äº†è¶³å¤Ÿå¤šçš„ä¸Šä¸‹æ–‡å¸®åŠ©æˆ‘ä»¬å¼€å§‹åšè¿™ä»¶äº‹æƒ…ï¼Œæˆ‘ä»¬è¦çŸ¥é“çš„æ˜¯å•å…ƒæµ‹è¯•å…¶å®å¹¶ä¸ä¼šé˜»ç¢æˆ‘ä»¬çš„å¼€å‘è¿›åº¦ï¼Œå®ƒèƒ½å¤Ÿä¸ºæˆ‘ä»¬çš„ä¸Šçº¿æä¾›ä¿¡å¿ƒï¼Œä¹Ÿæ˜¯è´¨é‡ä¿è¯ä¸ŠæŠ•èµ„å›æŠ¥ç‡æœ€é«˜çš„æ–¹æ³•ã€‚

å­¦ä¹ å†™å¥½å•å…ƒæµ‹è¯•ä¸€å®šä¼šæœ‰ä¸€äº›å­¦ä¹ æ›²çº¿å’Œä¸é€‚åº”ï¼Œç”šè‡³ä¼šåœ¨çŸ­æœŸå†…å½±å“æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ï¼Œä½†æ˜¯ç†Ÿæ‚‰äº†è¿™ä¸€å¥—æµç¨‹å’Œæ¥å£ä¹‹åï¼Œå•å…ƒæµ‹è¯•å¯¹æˆ‘ä»¬çš„å¸®åŠ©ä¼šéå¸¸å¤§ï¼Œæ¯ä¸€ä¸ªå•å…ƒæµ‹è¯•éƒ½è¡¨ç¤ºä¸€ä¸ªä¸šåŠ¡é€»è¾‘ï¼Œæ¯æ¬¡æäº¤æ—¶æ‰§è¡Œå•å…ƒæµ‹è¯•å°±èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ç¡®å®šæ–°çš„ä»£ç å¤§æ¦‚ç‡ä¸Šä¸ä¼šå½±å“å·²æœ‰çš„ä¸šåŠ¡é€»è¾‘ï¼Œèƒ½å¤Ÿæ˜æ˜¾åœ°é™ä½é‡æ„çš„é£é™©ä»¥åŠçº¿ä¸Šäº‹æ•…çš„æ•°é‡

# æ€»ç»“
åœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ä»ä¸‰ä¸ªæ–¹é¢åˆ†åˆ«ä»‹ç»äº†å¦‚ä½•å†™ä¼˜é›…çš„ Go è¯­è¨€ä»£ç ï¼Œä½œè€…å°½å¯èƒ½åœ°ç»™å‡ºäº†æœ€å®¹æ˜“æ“ä½œå’Œæœ€æœ‰æ•ˆçš„æ–¹æ³•ï¼š

- ä»£ç è§„èŒƒï¼šä½¿ç”¨è¾…åŠ©å·¥å…·å¸®åŠ©æˆ‘ä»¬åœ¨æ¯æ¬¡æäº¤ PR æ—¶è‡ªåŠ¨åŒ–åœ°å¯¹ä»£ç è¿›è¡Œæ£€æŸ¥ï¼Œå‡å°‘å·¥ç¨‹å¸ˆäººå·¥å®¡æŸ¥çš„å·¥ä½œé‡ï¼›
- æœ€ä½³å®è·µ
   - ç›®å½•ç»“æ„ï¼šéµå¾ª Go è¯­è¨€ç¤¾åŒºä¸­è¢«å¹¿æ³›è¾¾æˆå…±è¯†çš„ ç›®å½•ç»“æ„ï¼Œå‡å°‘é¡¹ç›®çš„æ²Ÿé€šæˆæœ¬ï¼›
   - æ¨¡å—æ‹†åˆ†ï¼šæŒ‰ç…§èŒè´£å¯¹ä¸åŒçš„æ¨¡å—è¿›è¡Œæ‹†åˆ†ï¼ŒGo è¯­è¨€çš„é¡¹ç›®ä¸­ä¹Ÿä¸åº”è¯¥å‡ºç° `model` ã€ `controller` è¿™ç§è¿åè¯­è¨€é¡¶å±‚è®¾è®¡æ€è·¯çš„åŒ…åï¼›
   - æ˜¾ç¤ºä¸éšå¼ï¼šå°½å¯èƒ½åœ°æ¶ˆç­é¡¹ç›®ä¸­çš„ `init` å‡½æ•°ï¼Œä¿è¯æ˜¾å¼åœ°è¿›è¡Œæ–¹æ³•çš„è°ƒç”¨ä»¥åŠé”™è¯¯çš„å¤„ç†ï¼›
   - é¢å‘æ¥å£ï¼šé¢å‘æ¥å£æ˜¯ Go è¯­è¨€é¼“åŠ±çš„å¼€å‘æ–¹å¼ï¼Œä¹Ÿèƒ½å¤Ÿä¸ºæˆ‘ä»¬å†™å•å…ƒæµ‹è¯•æä¾›æ–¹ä¾¿ï¼Œæˆ‘ä»¬åº”è¯¥éµå¾ªå›ºå®šçš„æ¨¡å¼å¯¹å¤–æä¾›åŠŸèƒ½ï¼›
      - ä½¿ç”¨å¤§å†™çš„ `Service` å¯¹å¤–æš´éœ²æ–¹æ³•ï¼›
      - ä½¿ç”¨å°å†™çš„ `service` å®ç°æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼›
      - é€šè¿‡ `func NewService(...) (Service, error)` å‡½æ•°åˆå§‹åŒ– `Service` æ¥å£ï¼›
- å•å…ƒæµ‹è¯•ï¼šä¿è¯é¡¹ç›®å·¥ç¨‹è´¨é‡çš„æœ€æœ‰æ•ˆåŠæ³•ï¼›
   - å¯æµ‹è¯•ï¼šæ„å‘³ç€é¢å‘æ¥å£ç¼–ç¨‹ä»¥åŠå‡å°‘å•ä¸ªå‡½æ•°ä¸­åŒ…å«çš„é€»è¾‘ï¼Œä½¿ç”¨ã€å°æ–¹æ³•ã€ï¼›
   - ç»„ç»‡æ–¹å¼ï¼šä½¿ç”¨ Go è¯­è¨€é»˜è®¤çš„ `Test` æ¡†æ¶ã€å¼€æºçš„ `suite` æˆ–è€… `BDD` çš„é£æ ¼å¯¹å•å…ƒæµ‹è¯•è¿›è¡Œåˆç†ç»„ç»‡ï¼›
   - Mock æ–¹æ³•ï¼šå››ç§ä¸åŒçš„å•å…ƒæµ‹è¯• Mock æ–¹æ³•ï¼›
      - gomockï¼šæœ€æ ‡å‡†çš„ä¹Ÿæ˜¯æœ€è¢«é¼“åŠ±çš„æ–¹å¼ï¼›
      - sqlmockï¼šå¤„ç†ä¾èµ–çš„æ•°æ®åº“ï¼›
      - httpmockï¼šå¤„ç†ä¾èµ–çš„ HTTP è¯·æ±‚ï¼›
      - monkeyï¼šä¸‡èƒ½çš„æ–¹æ³•ï¼Œä½†æ˜¯åªåœ¨ä¸‡ä¸å¾—å·²æ—¶ä½¿ç”¨ï¼Œç±»ä¼¼çš„ä»£ç å†™èµ·æ¥éå¸¸å†—é•¿è€Œä¸”ä¸ç›´è§‚ï¼›
   - æ–­è¨€ï¼šä½¿ç”¨ç¤¾åŒºçš„ `testify` å¿«é€ŸéªŒè¯æ–¹æ³•çš„è¿”å›å€¼ï¼›

æƒ³è¦å†™å‡ºä¼˜é›…çš„ä»£ç æœ¬èº«å°±ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œå®ƒéœ€è¦æˆ‘ä»¬ä¸æ–­åœ°å¯¹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»è¿›è¡Œæ›´æ–°å’Œä¼˜åŒ–ï¼Œæ¨å€’ä¹‹å‰çš„ç»éªŒå¹¶å¯¹é¡¹ç›®æŒç»­è¿›è¡Œå®Œå–„å’Œé‡æ„ï¼Œè€Œåªæœ‰çœŸæ­£ç»è¿‡æ€è€ƒå’Œè®¾è®¡çš„ä»£ç æ‰èƒ½å¤Ÿç»è¿‡æ—¶é—´çš„æ£€éªŒï¼ˆä»£ç æ˜¯éœ€è¦ä¸æ–­é‡æ„çš„ï¼‰ï¼Œéšæ„å †ç Œä»£ç çš„è¡Œä¸ºæ˜¯ä¸èƒ½é¼“åŠ±ä¹Ÿä¸åº”è¯¥å‘ç”Ÿçš„ï¼Œæ¯ä¸€è¡Œä»£ç éƒ½åº”è¯¥æŒ‰ç…§æœ€é«˜çš„æ ‡å‡†å»è®¾è®¡å’Œå¼€å‘ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¿è¯å·¥ç¨‹è´¨é‡çš„å”¯ä¸€æ–¹æ³•ã€‚

# Reference

- [åŸæ–‡ - å¦‚ä½•å†™å‡ºä¼˜é›…çš„ Golang ä»£ç ](https://draveness.me/golang-101)

- [RFC 793 - Transmission Control Protocol - IETF Tools](https://tools.ietf.org/html/rfc793)
- [goimports vs gofmt](http://goinbigdata.com/goimports-vs-gofmt/)
- [Style guideline for Go packages](https://rakyll.org/style-packages/)
- [Standard Package Layout](https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1)
- [Internal packages in Go](https://stackoverflow.com/questions/41571946/internal-packages-in-go)
- [The init function Â· Effective Go](https://golang.org/doc/effective_go.html#init)
